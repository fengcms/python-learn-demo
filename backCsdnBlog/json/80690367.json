{"data":{"id":"80690367","title":"Python3 \u521d\u5b66\u5b9e\u8df5\u6848\u4f8b\uff0814\uff09\u6253\u9020\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668","articleedittype":1,"description":"Python3 \u521d\u5b66\u5b9e\u8df5\u6848\u4f8b\uff0814\uff09\u6253\u9020\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668\n\n\u8fd1\u6765\u5de5\u4f5c\u538b\u529b\u9887\u5927\uff0c\u4e00\u76f4\u90fd\u5728\u4ece\u4e8b\u9879\u76ee\u7684\u5f00\u53d1\u5de5\u4f5c\uff0c\u6240\u4ee5\u81ea\u5b66 python \u7684\u8fdb\u5ea6\u4e5f\u62c9\u4e0b\u6765\u4e00\u622a\uff0c\u54ce\u3002\u7531\u4e8e\u8fdb\u6765\u5f88\u591a\u9879\u76ee\u7528 react \u7f16\u5199\uff0c\u6240\u4ee5\u51c6\u5907\u4e9b\u4e00\u4e9b\u76f8\u5173\u7684\u535a\u5ba2\u6587\u7ae0\u3002\u4f46\u662f\u535a\u5ba2\u7684\u56fe\u7247\u7ba1\u7406\u9887\u8ba9\u4eba\u70e6\u607c\u3002\u4e4b\u524d\u5c1d\u8bd5\u8fc7\u628a\u65b0\u6d6a\u5fae\u535a\u5f53\u6210\u56fe\u5e8a\uff0c\u4f46\u662f\u4e0a\u4f20\u7684\u7a33\u5b9a\u6027\u4e00\u76f4\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u4f7f\u7528 csdn \u7684\u535a\u5ba2\u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u5427\uff0c\u4e00\u76f4\u4e5f\u6bd4\u8f83\u4e0d\u65b9\u4fbf\u3002\u56e0\u6b64\uff0c\u6628\u5929\u7a81\u53d1\u5947\u60f3\uff0c\u51b3\u5b9a\u5199\u4e00...","content":"<h1 id=\"python3-\u521d\u5b66\u5b9e\u8df5\u6848\u4f8b14\u6253\u9020\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668\">Python3 \u521d\u5b66\u5b9e\u8df5\u6848\u4f8b\uff0814\uff09\u6253\u9020\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668<\/h1>\n\n<p>\u8fd1\u6765\u5de5\u4f5c\u538b\u529b\u9887\u5927\uff0c\u4e00\u76f4\u90fd\u5728\u4ece\u4e8b\u9879\u76ee\u7684\u5f00\u53d1\u5de5\u4f5c\uff0c\u6240\u4ee5\u81ea\u5b66 <code>python<\/code> \u7684\u8fdb\u5ea6\u4e5f\u62c9\u4e0b\u6765\u4e00\u622a\uff0c\u54ce\u3002\u7531\u4e8e\u8fdb\u6765\u5f88\u591a\u9879\u76ee\u7528 <code>react<\/code> \u7f16\u5199\uff0c\u6240\u4ee5\u51c6\u5907\u4e9b\u4e00\u4e9b\u76f8\u5173\u7684\u535a\u5ba2\u6587\u7ae0\u3002\u4f46\u662f\u535a\u5ba2\u7684\u56fe\u7247\u7ba1\u7406\u9887\u8ba9\u4eba\u70e6\u607c\u3002\u4e4b\u524d\u5c1d\u8bd5\u8fc7\u628a\u65b0\u6d6a\u5fae\u535a\u5f53\u6210\u56fe\u5e8a\uff0c\u4f46\u662f\u4e0a\u4f20\u7684\u7a33\u5b9a\u6027\u4e00\u76f4\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u4f7f\u7528 csdn \u7684\u535a\u5ba2\u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u5427\uff0c\u4e00\u76f4\u4e5f\u6bd4\u8f83\u4e0d\u65b9\u4fbf\u3002\u56e0\u6b64\uff0c\u6628\u5929\u7a81\u53d1\u5947\u60f3\uff0c\u51b3\u5b9a\u5199\u4e00\u4e2a\u79c1\u4eba\u7684\u56fe\u5e8a\u670d\u52a1\u5668\uff0c\u653e\u5728\u6211\u81ea\u5df1\u7684\u670d\u52a1\u5668\u4e0a\u3002<\/p>\n\n\n\n<h2 id=\"\u9700\u6c42\u5206\u6790\">\u9700\u6c42\u5206\u6790<\/h2>\n\n<p>\u8981\u5e72\u4ec0\u4e48\uff0c\u9996\u5148\u8981\u660e\u786e\uff0c\u5230\u5e95\u8981TM\u5e72\u4ec0\u4e48\u3002\u5217\u51fa\u9700\u6c42\u5982\u4e0b\uff1a<\/p>\n\n<ol>\n<li>\u8fd9\u662f\u4e00\u4e2a\u56fe\u7247\u4e0a\u4f20\u670d\u52a1\uff0c\u9700\u8981\u968f\u65f6\u63a5\u6536\u6211\u7684\u56fe\u7247\u6587\u4ef6\u3002<\/li>\n<li>\u53ea\u80fd\u63a5\u6536\u6211\u4e0a\u4f20\u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u8ba4\u8bc1\u673a\u5236\u3002<\/li>\n<li>\u53ea\u80fd\u5728\u6211\u5141\u8bb8\u7684\u7ad9\u70b9\u663e\u793a\u56fe\u7247\uff0c\u5176\u4ed6\u7ad9\u70b9\u90fd\u5e94\u8be5\u662f\u65e0\u6743\u8bbf\u95ee\uff0c\u6240\u8c13\u9632\u76d7\u94fe\u673a\u5236\u3002<\/li>\n<li>\u56fe\u7247\u4e0d\u5141\u8bb8\u91cd\u590d\u4e0a\u4f20\uff0c\u6bd5\u7adf\u786c\u76d8\u4e0d\u5927\u3002<\/li>\n<li>\u56e0\u4e3a\u53ea\u662f\u81ea\u5df1\u4f7f\u7528\uff0c\u6240\u4ee5\u6587\u4ef6\u6821\u9a8c\u548c\u56fe\u7247\u5927\u5c0f\u6821\u9a8c\u7b49\uff0c\u53ef\u4ee5\u653e\u677e\u3002<\/li>\n<\/ol>\n\n<p>\u7efc\u4e0a\uff0c\u662f\u6211\u7684\u9700\u6c42\u3002\u5c06\u4ed6\u4eec\u8be6\u7ec6\u5206\u6790\u4e00\u4e0b\uff0c\u5f97\u5230\uff1a<\/p>\n\n<ol>\n<li>\u6211\u9700\u8981\u4e00\u4e2a <code>http<\/code> \u7684\u63a5\u53e3\u670d\u52a1\uff0c\u4e3a <code>Post<\/code> \u63a5\u53e3\uff0c\u7528\u6765\u63a5\u53d7\u6211\u7684\u56fe\u7247\u4e0a\u4f20\u8bf7\u6c42\u3002<\/li>\n<li>\u56fe\u7247\u4e0d\u6821\u9a8c\u5927\u5c0f\uff0c\u91c7\u7528 <code>nginx<\/code> \u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u56fe\u7247\u6587\u4ef6\u683c\u5f0f\u6821\u9a8c\u91c7\u7528\u540e\u7f00\u540d\u3002<\/li>\n<li>\u8be5\u63a5\u53e3\u5fc5\u987b\u4f7f\u7528\u5bc6\u94a5\u9a8c\u8bc1\uff0c\u6ca1\u6709\u5bc6\u94a5\u7684\u4eba\u65e0\u6cd5\u8bbf\u95ee\u3002\u55ef\uff0c\u968f\u673a\u4e00\u4e2a\u52a0\u5bc6\u5b57\u7b26\u4e32\u5c31\u53ef\u4ee5\u3002<\/li>\n<li>\u56fe\u7247\u547d\u540d\u91c7\u7528 <code>md5<\/code> \u7684\u65b9\u5f0f\uff0c\u6211\u4e0d\u80fd\u4fdd\u8bc1\u81ea\u5df1\u4e0d\u4e0a\u4f20\u91cd\u590d\u6587\u4ef6\uff0c\u4f46\u8981\u4fdd\u8bc1\u670d\u52a1\u5668\u4e0d\u4f1a\u91cd\u590d\u6d6a\u8d39\u78c1\u76d8\u7a7a\u95f4\u3002<\/li>\n<li>\u56e0\u4e3a\u8981\u9632\u76d7\u94fe\uff0c\u867d\u7136\u53ef\u4ee5\u4f7f\u7528 <code>nginx<\/code> \u6765\u8fdb\u884c\u914d\u7f6e\uff0c\u4f46\u662f\uff0c\u8fd8\u662f\u5728 <code>python<\/code> \u4e2d\u5b9e\u73b0\u6bd4\u8f83\u597d\u3002<\/li>\n<li>\u6240\u4ee5\u9700\u8981\u4e00\u4e2a <code>get<\/code> \u63a5\u53e3\uff0c\u901a\u8fc7\u63a5\u53e3\u5224\u65ad\u662f\u5426\u5177\u6709\u6743\u9650\uff0c\u8fd4\u56de\u4e0d\u540c\u56fe\u7247\u3002<\/li>\n<\/ol>\n\n\n\n<h2 id=\"\u5f00\u53d1\u56fe\u5e8a\">\u5f00\u53d1\u56fe\u5e8a<\/h2>\n\n\n\n<h3 id=\"\u6280\u672f\u9009\u578b\">\u6280\u672f\u9009\u578b<\/h3>\n\n<p>\u9996\u5148\uff0c\u662f\u4f7f\u7528 <code>python3.6<\/code> \u4e3a\u5f00\u53d1\u8bed\u8a00\uff0c\u8fd9\u4e2a\u662f\u786e\u5b9a\u4e86\u7684\u3002\u4f46\u662f\u5982\u4f55\u5f00\u53d1\u8fd9\u4e2a\uff0c\u6211\u82b1\u4e865\u5206\u949f\u8003\u8651\u4e86\u4e00\u4e0b\u3002\u7b2c\u4e00\u79cd\u5462\uff0c\u662f\u5168\u90e8\u81ea\u5df1\u5b9e\u73b0\u3002\u4e5f\u4e0d\u662f\u4e0d\u53ef\u4ee5\uff0c\u4f46\u662f\u6211\u611f\u89c9\u8017\u8d39\u7684\u65f6\u95f4\u6709\u70b9\u4e0d\u503c\u5f53\u5b50\u3002\u7b2c\u4e8c\u79cd\u5462\uff0c\u662f\u4f7f\u7528\u516c\u53f8\u76ee\u524d\u91c7\u7528\u7684\u81ea\u7814\u5f00\u53d1\u6846\u67b6\uff0c\u8fd9\u4e2a\u662f\u6700\u987a\u624b\u7684\uff0c\u4f46\u95ee\u9898\u662f\uff0c\u6211\u5c31\u662f\u5e72\u8fd9\u4e48\u4e2a\u5c0f\u6d3b\u513f\uff0c\u4e0d\u81f3\u4e8e\u6740\u9e21\u7528\u725b\u5200\u3002\u55ef\uff0c\u90a3\u5c31\u91c7\u7528\u7b2c\u4e09\u65b9\u7684\u6846\u67b6\uff0c\u5e76\u8fc5\u901f\u7684\u9501\u5b9a\u4e86 <code>sanic<\/code> \u6846\u67b6\u3002<\/p>\n\n<p><code>sanic<\/code> \u662f\u4e00\u4e2a\u6bd4\u8f83\u65b0\u7684\uff0c\u4f46\u662f\u53d1\u5c55\u6bd4\u8f83\u5feb\u7684\u6846\u67b6\u3002\u5176\u7279\u5f81\u662f\u901f\u5ea6\u975e\u5e38\u5feb\u3002\u636e\u4ed6\u4eec\u5b98\u65b9\u7f51\u7ad9\u81ea\u5df1\u8bf4\uff0c<code>sanic<\/code> \u662f\u6700\u5feb\u7684 <code>python<\/code> \u6846\u67b6\u3002<\/p>\n\n<blockquote>\n  <p><code>sanic<\/code> \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1a<a href=\"http:\/\/sanic.readthedocs.io\/en\/latest\/\">http:\/\/sanic.readthedocs.io\/en\/latest\/<\/a><\/p>\n<\/blockquote>\n\n<p>\u5f00\u5e72\u3002<\/p>\n\n\n\n<h3 id=\"\u6700\u7ec8\u4ee3\u7801\">\u6700\u7ec8\u4ee3\u7801<\/h3>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-python hljs \"><span class=\"hljs-comment\">#!\/usr\/bin\/env python3<\/span>\n<span class=\"hljs-comment\"># -*- coding: UTF-8 -*-<\/span>\n<span class=\"hljs-keyword\">from<\/span> sanic <span class=\"hljs-keyword\">import<\/span> Sanic\n<span class=\"hljs-keyword\">from<\/span> sanic.response <span class=\"hljs-keyword\">import<\/span> json, text, file\n<span class=\"hljs-keyword\">import<\/span> os, sys\n<span class=\"hljs-keyword\">import<\/span> hashlib\n<span class=\"hljs-keyword\">import<\/span> base64\n\napp = Sanic()\n<span class=\"hljs-comment\"># \u56fe\u7247\u5b58\u50a8\u76ee\u5f55<\/span>\nbaseDir = sys.path[<span class=\"hljs-number\">0<\/span>] + <span class=\"hljs-string\">'\/image\/'<\/span>\n<span class=\"hljs-comment\"># \u6821\u9a8c Token \u5199\u6b7b\u5c31\u6210\uff0c\u53cd\u6b63\u81ea\u5df1\u7528\u7684\u561b<\/span>\ntoken = <span class=\"hljs-string\">'SheIsABeautifulGirl'<\/span>\n<span class=\"hljs-comment\"># \u5141\u8bb8\u7684\u57df\u540d\u5217\u8868<\/span>\nallowHost = [\n            <span class=\"hljs-string\">'localhost'<\/span>,\n            <span class=\"hljs-string\">'ilovethisword'<\/span>,\n            <span class=\"hljs-string\">'i.fengcss.com'<\/span>,\n            <span class=\"hljs-string\">'blog.csdn.net'<\/span>\n        ]\n\n<span class=\"hljs-comment\"># \u6210\u529f\u8fd4\u56de\u65b9\u6cd5<\/span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">ok<\/span><span class=\"hljs-params\">(data)<\/span>:<\/span>\n    <span class=\"hljs-keyword\">if<\/span> type(data) == list:\n        <span class=\"hljs-keyword\">return<\/span> json({<span class=\"hljs-string\">\"data\"<\/span>: {<span class=\"hljs-string\">\"list\"<\/span>: data}, <span class=\"hljs-string\">\"status\"<\/span>: <span class=\"hljs-number\">0<\/span>})\n    <span class=\"hljs-keyword\">else<\/span>:\n        <span class=\"hljs-keyword\">return<\/span> json({<span class=\"hljs-string\">\"data\"<\/span>: data, <span class=\"hljs-string\">\"status\"<\/span>: <span class=\"hljs-number\">0<\/span>})\n<span class=\"hljs-comment\"># \u5931\u8d25\u8fd4\u56de\u65b9\u6cd5<\/span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">fail<\/span><span class=\"hljs-params\">(data)<\/span>:<\/span>\n    <span class=\"hljs-keyword\">return<\/span> json({<span class=\"hljs-string\">\"data\"<\/span>: data, <span class=\"hljs-string\">\"status\"<\/span>: <span class=\"hljs-number\">1<\/span>})\n\n<span class=\"hljs-comment\"># \u83b7\u53d6\u56fe\u7247\u540e\u7f00\u540d<\/span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">getSuffix<\/span><span class=\"hljs-params\">(filename)<\/span>:<\/span>\n    tempArr = filename.split(<span class=\"hljs-string\">'.'<\/span>)\n    suffix = tempArr[-<span class=\"hljs-number\">1<\/span>]\n    fileType = [<span class=\"hljs-string\">'jpg'<\/span>, <span class=\"hljs-string\">'jpeg'<\/span>, <span class=\"hljs-string\">'gif'<\/span>, <span class=\"hljs-string\">'png'<\/span>]\n    <span class=\"hljs-keyword\">if<\/span> len(tempArr) &lt; <span class=\"hljs-number\">2<\/span>:\n        <span class=\"hljs-keyword\">return<\/span> <span class=\"hljs-string\">'error name'<\/span>\n    <span class=\"hljs-keyword\">elif<\/span> suffix <span class=\"hljs-keyword\">not<\/span> <span class=\"hljs-keyword\">in<\/span> fileType:\n        <span class=\"hljs-keyword\">return<\/span> <span class=\"hljs-string\">'error type'<\/span>\n    <span class=\"hljs-keyword\">else<\/span>:\n        <span class=\"hljs-keyword\">return<\/span> suffix\n<span class=\"hljs-comment\"># \u68c0\u67e5\u8bf7\u6c42\u5730\u5740\u662f\u5426\u6388\u6743<\/span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">checkHost<\/span><span class=\"hljs-params\">(host)<\/span>:<\/span>\n    <span class=\"hljs-keyword\">for<\/span> i <span class=\"hljs-keyword\">in<\/span> allowHost:\n        <span class=\"hljs-keyword\">if<\/span> i <span class=\"hljs-keyword\">in<\/span> host:\n            <span class=\"hljs-keyword\">return<\/span> <span class=\"hljs-keyword\">True<\/span>\n    <span class=\"hljs-keyword\">return<\/span> <span class=\"hljs-keyword\">False<\/span>\n\n<span class=\"hljs-comment\"># \u4e0a\u4f20\u56fe\u7247\u6587\u4ef6\u63a5\u53e3<\/span>\n<span class=\"hljs-decorator\">@app.route('\/api\/v1\/upimg', methods=['POST'])<\/span>\nasync <span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">upimg<\/span><span class=\"hljs-params\">(request)<\/span>:<\/span>\n    <span class=\"hljs-comment\"># \u5224\u65ad\u7528\u6237\u662f\u5426\u5177\u6709\u4e0a\u4f20\u6743\u9650<\/span>\n    <span class=\"hljs-keyword\">if<\/span> request.headers.get(<span class=\"hljs-string\">'token'<\/span>) != token:\n        <span class=\"hljs-keyword\">return<\/span> fail(<span class=\"hljs-string\">'\u60a8\u6ca1\u6709\u4f7f\u7528\u672c\u670d\u52a1\u7684\u6743\u9650'<\/span>)\n    image = request.files.get(<span class=\"hljs-string\">'file'<\/span>).body\n    <span class=\"hljs-comment\"># \u5224\u65ad\u6587\u4ef6\u662f\u5426\u652f\u6301<\/span>\n    imageName = request.files.get(<span class=\"hljs-string\">'file'<\/span>).name\n    imageSuffix = getSuffix(imageName)\n    <span class=\"hljs-keyword\">if<\/span> <span class=\"hljs-string\">'error'<\/span> <span class=\"hljs-keyword\">in<\/span> imageSuffix:\n        <span class=\"hljs-keyword\">return<\/span> fail(imageSuffix)\n    <span class=\"hljs-comment\"># \u7ec4\u7ec7\u56fe\u7247\u5b58\u50a8\u8def\u5f84<\/span>\n    m1 = hashlib.md5()\n    m1.update(image)\n    md5Name = m1.hexdigest()\n\n    <span class=\"hljs-comment\"># \u7528 md5 \u7684\u524d\u4e24\u4f4d\u6765\u5efa\u6587\u4ef6\u5939\uff0c\u9632\u6b62\u5355\u4e2a\u6587\u4ef6\u5939\u4e0b\u56fe\u7247\u8fc7\u591a\uff0c\u53c8\u6216\u8005\u6839\u76ee\u5f55\u4e0b\u5efa\u7acb\u592a\u591a\u7684\u6587\u4ef6\u5939<\/span>\n    saveDir = baseDir + md5Name[<span class=\"hljs-number\">0<\/span>:<span class=\"hljs-number\">2<\/span>] + <span class=\"hljs-string\">'\/'<\/span>\n    savePath = saveDir + md5Name[<span class=\"hljs-number\">2<\/span>:] + <span class=\"hljs-string\">'.'<\/span> + imageSuffix\n    resPath = <span class=\"hljs-string\">'\/'<\/span> + md5Name[<span class=\"hljs-number\">0<\/span>:<span class=\"hljs-number\">2<\/span>] + <span class=\"hljs-string\">'\/'<\/span> + md5Name[<span class=\"hljs-number\">2<\/span>:] + <span class=\"hljs-string\">'.'<\/span> + imageSuffix\n\n    <span class=\"hljs-comment\"># \u5982\u679c\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u6587\u4ef6\u5939<\/span>\n    <span class=\"hljs-keyword\">if<\/span> <span class=\"hljs-keyword\">not<\/span> os.path.exists(saveDir):\n        os.makedirs(saveDir)\n\n    <span class=\"hljs-comment\"># \u5c06\u6587\u4ef6\u5199\u5165\u5230\u786c\u76d8<\/span>\n    tempFile = open(savePath, <span class=\"hljs-string\">'wb'<\/span>)\n    tempFile.write(image)\n    tempFile.close()\n\n    <span class=\"hljs-comment\"># \u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c<\/span>\n    <span class=\"hljs-keyword\">return<\/span> ok({<span class=\"hljs-string\">\"path\"<\/span>: resPath})\n\n<span class=\"hljs-comment\"># \u8bf7\u6c42\u56fe\u7247\u63a5\u53e3<\/span>\n<span class=\"hljs-decorator\">@app.route('\/', methods=['GET'])<\/span>\nasync <span class=\"hljs-function\"><span class=\"hljs-keyword\">def<\/span> <span class=\"hljs-title\">img<\/span><span class=\"hljs-params\">(request)<\/span>:<\/span>\n    <span class=\"hljs-comment\"># \u5224\u65ad\u662f\u5426\u4e3a\u7f51\u7ad9\u8bf7\u6c42\uff0c\u5426\u5219\u5c31\u52a0\u4e0a\u81ea\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\uff08\u5141\u8bb8\u672c\u5730\u8bbf\u95ee\uff09<\/span>\n    host = request.headers.get(<span class=\"hljs-string\">'referer'<\/span>) <span class=\"hljs-keyword\">or<\/span> <span class=\"hljs-string\">'ilovethisword'<\/span>\n    <span class=\"hljs-comment\"># \u5224\u65ad\u8bf7\u6c42\u63a5\u53e3\u662f\u5426\u5e26\u53c2\u6570\uff0c\u5426\u5219\u52a0\u4e0a\u81ea\u5b9a\u4e49\u5b57\u7b26\u4e32\uff08\u6ca1\u6709\u8fd9\u4e2a\u6587\u4ef6\u5939\uff0c\u8fd4\u56de404\uff09<\/span>\n    args = request.args.get(<span class=\"hljs-string\">'path'<\/span>) <span class=\"hljs-keyword\">or<\/span> <span class=\"hljs-string\">'ilovemywife'<\/span>\n    <span class=\"hljs-comment\"># \u62fc\u63a5\u6587\u4ef6\u5730\u5740<\/span>\n    path = baseDir + args\n    <span class=\"hljs-comment\"># \u5982\u679c\u4e0d\u5728\u5141\u8bb8\u5217\u8868\uff0c\u5219\u5c55\u793a 401 \u56fe\u7247<\/span>\n    <span class=\"hljs-keyword\">if<\/span> <span class=\"hljs-keyword\">not<\/span> checkHost(host):\n        path = baseDir + <span class=\"hljs-string\">'\/7b\/e49a54f761da42174d6121fa13e0b3.png'<\/span>\n    <span class=\"hljs-comment\"># \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u5c55\u793a 404 \u56fe\u7247<\/span>\n    <span class=\"hljs-keyword\">if<\/span> <span class=\"hljs-keyword\">not<\/span> os.path.exists(path):\n        path = baseDir + <span class=\"hljs-string\">'\/b4\/74335c3944f42275e3caa13930a9b9.png'<\/span>\n    <span class=\"hljs-comment\"># \u8fd4\u56de\u6587\u4ef6<\/span>\n    <span class=\"hljs-keyword\">return<\/span> await file(path)\n<span class=\"hljs-comment\"># \u542f\u52a8\u670d\u52a1<\/span>\n<span class=\"hljs-keyword\">if<\/span> __name__ == <span class=\"hljs-string\">\"__main__\"<\/span>:\n    app.run(host=<span class=\"hljs-string\">\"127.0.0.1\"<\/span>, port=<span class=\"hljs-number\">8000<\/span>)<\/code><\/pre>\n\n\n\n<h2 id=\"\u90e8\u7f72\u56fe\u5e8a\">\u90e8\u7f72\u56fe\u5e8a<\/h2>\n\n<p>\u7a0b\u5e8f\u5f00\u53d1\u5b8c\u6210\u540e\uff0c\u901a\u8fc7\u672c\u5730\u6d4b\u8bd5\uff0c\u786e\u5b9a\u6ca1\u5565\u95ee\u9898\uff0c\u51b3\u5b9a\u4e0a\u751f\u4ea7\u73af\u5883\u3002\uff08\u5c31\u662f\u653e\u5230\u6211\u7684\u5c0f\u7834\u9a74\u4e0a\u53bb\uff09<\/p>\n\n<p><code>centos 7<\/code> \u7cfb\u7edf <code>yum<\/code> \u6e90\u4e2d <code>python<\/code> \u6700\u9ad8\u7248\u672c\u4e3a 3.4 \uff0c\u55ef\uff0c\u5b89\u88c5\u4e00\u4e0b\u3002\u4e0d\u8be6\u8ff0\u4e86\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b<a href=\"https:\/\/www.rosehosting.com\/blog\/how-to-install-python-3-6-4-on-centos-7\/\">How to Install Python 3.6.4 on CentOS 7<\/a><\/p>\n\n<p>\u641e\u597d\u73af\u5883\u4e4b\u540e\uff0c\u5148\u627e\u4e2a\u5730\u65b9\u628a\u6587\u4ef6\u6751\u4e0a\u3002\u8fd9\u91cc\u6211\u7684\u5b58\u50a8\u4f4d\u7f6e\u662f <code>\/srv\/py-tuchuang\/run.py<\/code><\/p>\n\n\n\n<h3 id=\"\u914d\u7f6e-python-\u670d\u52a1\">\u914d\u7f6e python \u670d\u52a1<\/h3>\n\n<p>\u9996\u5148\uff0c\u6211\u4eec\u4f7f\u7528 <code>chmod +x \/srv\/py-tuchuang\/run.py<\/code> \u547d\u4ee4\uff0c\u8ba9\u7a0b\u5e8f\u5177\u6709\u6267\u884c\u6743\u9650\u3002<\/p>\n\n<p>\u7136\u540e\uff0c\u6211\u4eec\u7528 <code>vim \/usr\/lib\/systemd\/system\/py-tuchuang.service<\/code> \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u7a0b\u5e8f\u6587\u4ef6\uff0c\u7136\u540e\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9<\/p>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-shell hljs makefile\">[Unit]\n<span class=\"hljs-constant\">Description<\/span>=Python image upload and download Service\n<span class=\"hljs-constant\">After<\/span>=network.target\n<span class=\"hljs-constant\">Wants<\/span>=network.target\n\n[Service]\n<span class=\"hljs-constant\">Type<\/span>=simple\n<span class=\"hljs-comment\"># \u7528\u6237\u8981\u914d\u7f6e\u6709\u6587\u4ef6\u8bfb\u5199\u6743\u9650\u7684\uff0c\u5b9e\u5728\u4e0d\u884c\u5c31root<\/span>\n<span class=\"hljs-constant\">User<\/span>=root\n<span class=\"hljs-constant\">Group<\/span>=root\n<span class=\"hljs-comment\"># \u91cd\u8981\u7684\u5c31\u662f\u4e0b\u9762\u7684\u8fd9\u53e5\u8bdd<\/span>\n<span class=\"hljs-constant\">ExecStart<\/span>=\/srv\/py-tuchuang\/run.py\n\n[Install]\n<span class=\"hljs-constant\">WantedBy<\/span>=multi-user.target<\/code><\/pre>\n\n<p>\u4fdd\u5b58\u9000\u51fa\u4e4b\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5206\u522b\u8bbe\u7f6e\u7acb\u5373\u542f\u52a8\u548c\u5f00\u673a\u542f\u52a8<\/p>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-shell hljs vala\"><span class=\"hljs-preprocessor\"># \u542f\u52a8\u670d\u52a1<\/span>\nsystemctl start py-tuchuang.service\n<span class=\"hljs-preprocessor\"># \u5c06\u670d\u52a1\u8bbe\u7f6e\u4e3a\u5f00\u673a\u542f\u52a8<\/span>\nsystemctl enable py-tuchuang.service<\/code><\/pre>\n\n<p>\u597d\uff0c\u4ee5\u4e0a\uff0c\u6211\u4eec\u7684\u670d\u52a1\u5c31\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\u3002\u4f46\u662f\uff0c\u6211\u4eec\u7a0b\u5e8f\u4e2d\u8bbe\u5b9a\u6211\u4eec\u7684\u670d\u52a1\u662f\u8dd1\u5728 <code>127.0.0.1<\/code> \u8fd9\u4e2a <code>ip<\/code> \u4e0a\u7684\u3002\u6240\u4ee5\uff0c\u4ed6\u53ea\u80fd\u8dd1\u5728\u672c\u5730\uff0c\u4f60\u4e0d\u80fd\u8bbf\u95ee\u5230\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u5c42\u4ee3\u7406\u3002<\/p>\n\n\n\n<h3 id=\"\u914d\u7f6e-nginx-\u4ee3\u7406\">\u914d\u7f6e nginx \u4ee3\u7406<\/h3>\n\n<p><code>nginx<\/code> \u662f\u6211\u670d\u52a1\u5668\u4e0a\u73b0\u6210\u7684\uff0c\u6bd5\u7adf\u670d\u52a1\u5668\u4e0d\u662f\u4e3a\u4e86\u4e13\u95e8\u5e72\u8fd9\u4e48\u4e00\u4ef6\u7834\u4e8b\u513f\u561b\u3002<\/p>\n\n<p><code>vim \/etc\/nginx\/nginx.conf<\/code> \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u5408\u9002\u4f4d\u7f6e\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9<\/p>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-shell hljs axapta\"><span class=\"hljs-keyword\">server<\/span> {\n  server_name __YOU_DOMAIN_IN_HERE__;\n  location \/ {\n    proxy_pass  http:<span class=\"hljs-comment\">\/\/127.0.0.1:8000;<\/span>\n  }\n}<\/code><\/pre>\n\n<p>\u7136\u540e\u4fdd\u5b58\u9000\u51fa\uff0c\u91cd\u542f <code>nginx<\/code> \u670d\u52a1\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u5566\u3002<\/p>\n\n\n\n<h2 id=\"\u4f7f\u7528\u56fe\u5e8a\">\u4f7f\u7528\u56fe\u5e8a<\/h2>\n\n<p>\u56fe\u5e8a\u5df2\u7ecf\u642d\u5efa\u597d\u4e86\uff0c\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5462\uff1f\u65b9\u6cd5\u6709\u5f88\u591a\u54e6\uff01<\/p>\n\n\n\n<h3 id=\"\u547d\u4ee4\u884c\u4e0a\u4f20\u56fe\u7247\">\u547d\u4ee4\u884c\u4e0a\u4f20\u56fe\u7247<\/h3>\n\n<p>\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e0a\u4f20\u6587\u4ef6\u4e86\u3002<\/p>\n\n\n\n<pre class=\"prettyprint\"><code class=\"language-shell hljs ruby\">curl <span class=\"hljs-symbol\">http:<\/span>\/<span class=\"hljs-regexp\">\/__YOU_DOMAIN_IN_HERE__\/api<\/span><span class=\"hljs-regexp\">\/v1\/upimg<\/span> -<span class=\"hljs-constant\">F<\/span> <span class=\"hljs-string\">\"file=@__UPFILE__PATH__\"<\/span> -<span class=\"hljs-constant\">H<\/span> <span class=\"hljs-string\">\"token: SheIsABeautifulGirl\"<\/span> -v<\/code><\/pre>\n\n<p>\u5c06\u4e0a\u9762\u7684 <code>__YOU_DOMAIN_IN_HERE__<\/code> \u66ff\u6362\u4e3a\u4f60\u7684\u670d\u52a1\u57df\u540d\uff0c <code>__UPFILE__PATH__<\/code> \u4fee\u6539\u4e3a\u4f60\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u4e0a\u4f20\u6587\u4ef6\u5566~<\/p>\n\n<p>\u518d\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u5b8c\u5168\u53ef\u4ee5\u5566\u3002\u4e0d\u8fc7\u8fd8\u662f\u7834\u70e6\u3002<\/p>\n\n\n\n<h3 id=\"\u81ea\u5df1\u5199\u4e00\u4e2a\u524d\u7aef\u9875\u9762\u4e13\u95e8\u7528\u6765\u4e0a\u4f20\">\u81ea\u5df1\u5199\u4e00\u4e2a\u524d\u7aef\u9875\u9762\uff0c\u4e13\u95e8\u7528\u6765\u4e0a\u4f20<\/h3>\n\n<p>\u2026\u7701\u7565<\/p>\n\n<blockquote>\n  <p>\u7528 <code>jquery<\/code> \u6216\u8005 <code>vue<\/code> \u6216\u8005\u5176\u4ed6\u4ec0\u4e48\uff0c\u5199\u4e00\u4e2a\u4e0a\u4f20\u6587\u4ef6\u7684\u524d\u7aef\u811a\u672c\u8fd8\u662f\u4e0d\u96be\u7684\uff0c\u4e0d\u8fc7\u4e0d\u5728\u672c\u6587\u8ba8\u8bba\u8303\u56f4\u4e4b\u5185\u3002<\/p>\n<\/blockquote>\n\n\n\n<h3 id=\"\u914d\u7f6e-mweb-\u7f16\u8f91\u5668\u56fe\u5e8a\">\u914d\u7f6e MWeb \u7f16\u8f91\u5668\u56fe\u5e8a<\/h3>\n\n<p>\u5982\u4e0b\u56fe\u914d\u7f6e MWeb \u7f16\u8f91\u5668\uff0c\u7136\u540e\u5728\u91cc\u9762\u5199\u6587\u7ae0\u7684\u65f6\u5019\uff0c\u5c31\u592aTM\u65b9\u4fbf\u5566\u3002\u968f\u4fbf\u4e00\u4e2a\u5c4f\u5e55\u622a\u56fe\uff0c\u4e5f\u4e0d\u9700\u8981\u4fdd\u5b58\uff0c\u76f4\u63a5\u5230\u7f16\u8f91\u5668\u4e2d\u7c98\u8d34\uff0c\u5c31\u4f1a\u81ea\u52a8\u4e0a\u4f20\uff0c\u5e76\u83b7\u53d6\u5730\u5740\uff0c\u53d8\u6210 markdown \u4ee3\u7801\u5b58\u597d\u3002<\/p>\n\n<p><img src=\"https:\/\/raw.githubusercontent.com\/fengcms\/articles\/master\/image\/7f\/bd8f43f8166b9b14f3e024996ffa4d.png\" alt=\"20180614104107\" title=\"\"><\/p>\n\n<p>\u672c\u5730\u56fe\u7247\u4e5f\u662f\u975e\u5e38\u65b9\u4fbf\uff0c\u76f4\u63a5\u5f80\u7f16\u8f91\u5668\u4e2d\u4e00\u62d6\u52a8\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002<\/p>\n\n<p>\u597d\uff0c\u8fd9\u5c31\u662f\u672c\u4eba\u81ea\u5df1\u641e\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668\u7684\u5168\u90e8\u8fc7\u7a0b\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9\u3002<\/p>\n\n<p>\u672c\u6587\u7531 FungLeo \u539f\u521b\uff0c\u5141\u8bb8\u8f6c\u8f7d\uff0c\u4f46\u8f6c\u8f7d\u5fc5\u987b\u4fdd\u7559\u9996\u53d1\u94fe\u63a5\u3002<\/p>","markdowncontent":"# Python3 \u521d\u5b66\u5b9e\u8df5\u6848\u4f8b\uff0814\uff09\u6253\u9020\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668\n\n\u8fd1\u6765\u5de5\u4f5c\u538b\u529b\u9887\u5927\uff0c\u4e00\u76f4\u90fd\u5728\u4ece\u4e8b\u9879\u76ee\u7684\u5f00\u53d1\u5de5\u4f5c\uff0c\u6240\u4ee5\u81ea\u5b66 `python` \u7684\u8fdb\u5ea6\u4e5f\u62c9\u4e0b\u6765\u4e00\u622a\uff0c\u54ce\u3002\u7531\u4e8e\u8fdb\u6765\u5f88\u591a\u9879\u76ee\u7528 `react` \u7f16\u5199\uff0c\u6240\u4ee5\u51c6\u5907\u4e9b\u4e00\u4e9b\u76f8\u5173\u7684\u535a\u5ba2\u6587\u7ae0\u3002\u4f46\u662f\u535a\u5ba2\u7684\u56fe\u7247\u7ba1\u7406\u9887\u8ba9\u4eba\u70e6\u607c\u3002\u4e4b\u524d\u5c1d\u8bd5\u8fc7\u628a\u65b0\u6d6a\u5fae\u535a\u5f53\u6210\u56fe\u5e8a\uff0c\u4f46\u662f\u4e0a\u4f20\u7684\u7a33\u5b9a\u6027\u4e00\u76f4\u662f\u4e00\u4e2a\u95ee\u9898\u3002\u4f7f\u7528 csdn \u7684\u535a\u5ba2\u56fe\u7247\u4e0a\u4f20\u529f\u80fd\u5427\uff0c\u4e00\u76f4\u4e5f\u6bd4\u8f83\u4e0d\u65b9\u4fbf\u3002\u56e0\u6b64\uff0c\u6628\u5929\u7a81\u53d1\u5947\u60f3\uff0c\u51b3\u5b9a\u5199\u4e00\u4e2a\u79c1\u4eba\u7684\u56fe\u5e8a\u670d\u52a1\u5668\uff0c\u653e\u5728\u6211\u81ea\u5df1\u7684\u670d\u52a1\u5668\u4e0a\u3002\n\n## \u9700\u6c42\u5206\u6790\n\n\u8981\u5e72\u4ec0\u4e48\uff0c\u9996\u5148\u8981\u660e\u786e\uff0c\u5230\u5e95\u8981TM\u5e72\u4ec0\u4e48\u3002\u5217\u51fa\u9700\u6c42\u5982\u4e0b\uff1a\n\n1. \u8fd9\u662f\u4e00\u4e2a\u56fe\u7247\u4e0a\u4f20\u670d\u52a1\uff0c\u9700\u8981\u968f\u65f6\u63a5\u6536\u6211\u7684\u56fe\u7247\u6587\u4ef6\u3002\n2. \u53ea\u80fd\u63a5\u6536\u6211\u4e0a\u4f20\u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u8ba4\u8bc1\u673a\u5236\u3002\n3. \u53ea\u80fd\u5728\u6211\u5141\u8bb8\u7684\u7ad9\u70b9\u663e\u793a\u56fe\u7247\uff0c\u5176\u4ed6\u7ad9\u70b9\u90fd\u5e94\u8be5\u662f\u65e0\u6743\u8bbf\u95ee\uff0c\u6240\u8c13\u9632\u76d7\u94fe\u673a\u5236\u3002\n4. \u56fe\u7247\u4e0d\u5141\u8bb8\u91cd\u590d\u4e0a\u4f20\uff0c\u6bd5\u7adf\u786c\u76d8\u4e0d\u5927\u3002\n5. \u56e0\u4e3a\u53ea\u662f\u81ea\u5df1\u4f7f\u7528\uff0c\u6240\u4ee5\u6587\u4ef6\u6821\u9a8c\u548c\u56fe\u7247\u5927\u5c0f\u6821\u9a8c\u7b49\uff0c\u53ef\u4ee5\u653e\u677e\u3002\n\n\u7efc\u4e0a\uff0c\u662f\u6211\u7684\u9700\u6c42\u3002\u5c06\u4ed6\u4eec\u8be6\u7ec6\u5206\u6790\u4e00\u4e0b\uff0c\u5f97\u5230\uff1a\n\n1. \u6211\u9700\u8981\u4e00\u4e2a `http` \u7684\u63a5\u53e3\u670d\u52a1\uff0c\u4e3a `Post` \u63a5\u53e3\uff0c\u7528\u6765\u63a5\u53d7\u6211\u7684\u56fe\u7247\u4e0a\u4f20\u8bf7\u6c42\u3002\n2. \u56fe\u7247\u4e0d\u6821\u9a8c\u5927\u5c0f\uff0c\u91c7\u7528 `nginx` \u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u56fe\u7247\u6587\u4ef6\u683c\u5f0f\u6821\u9a8c\u91c7\u7528\u540e\u7f00\u540d\u3002\n3. \u8be5\u63a5\u53e3\u5fc5\u987b\u4f7f\u7528\u5bc6\u94a5\u9a8c\u8bc1\uff0c\u6ca1\u6709\u5bc6\u94a5\u7684\u4eba\u65e0\u6cd5\u8bbf\u95ee\u3002\u55ef\uff0c\u968f\u673a\u4e00\u4e2a\u52a0\u5bc6\u5b57\u7b26\u4e32\u5c31\u53ef\u4ee5\u3002\n4. \u56fe\u7247\u547d\u540d\u91c7\u7528 `md5` \u7684\u65b9\u5f0f\uff0c\u6211\u4e0d\u80fd\u4fdd\u8bc1\u81ea\u5df1\u4e0d\u4e0a\u4f20\u91cd\u590d\u6587\u4ef6\uff0c\u4f46\u8981\u4fdd\u8bc1\u670d\u52a1\u5668\u4e0d\u4f1a\u91cd\u590d\u6d6a\u8d39\u78c1\u76d8\u7a7a\u95f4\u3002\n5. \u56e0\u4e3a\u8981\u9632\u76d7\u94fe\uff0c\u867d\u7136\u53ef\u4ee5\u4f7f\u7528 `nginx` \u6765\u8fdb\u884c\u914d\u7f6e\uff0c\u4f46\u662f\uff0c\u8fd8\u662f\u5728 `python` \u4e2d\u5b9e\u73b0\u6bd4\u8f83\u597d\u3002\n6. \u6240\u4ee5\u9700\u8981\u4e00\u4e2a `get` \u63a5\u53e3\uff0c\u901a\u8fc7\u63a5\u53e3\u5224\u65ad\u662f\u5426\u5177\u6709\u6743\u9650\uff0c\u8fd4\u56de\u4e0d\u540c\u56fe\u7247\u3002\n\n## \u5f00\u53d1\u56fe\u5e8a\n\n### \u6280\u672f\u9009\u578b\n\n\u9996\u5148\uff0c\u662f\u4f7f\u7528 `python3.6` \u4e3a\u5f00\u53d1\u8bed\u8a00\uff0c\u8fd9\u4e2a\u662f\u786e\u5b9a\u4e86\u7684\u3002\u4f46\u662f\u5982\u4f55\u5f00\u53d1\u8fd9\u4e2a\uff0c\u6211\u82b1\u4e865\u5206\u949f\u8003\u8651\u4e86\u4e00\u4e0b\u3002\u7b2c\u4e00\u79cd\u5462\uff0c\u662f\u5168\u90e8\u81ea\u5df1\u5b9e\u73b0\u3002\u4e5f\u4e0d\u662f\u4e0d\u53ef\u4ee5\uff0c\u4f46\u662f\u6211\u611f\u89c9\u8017\u8d39\u7684\u65f6\u95f4\u6709\u70b9\u4e0d\u503c\u5f53\u5b50\u3002\u7b2c\u4e8c\u79cd\u5462\uff0c\u662f\u4f7f\u7528\u516c\u53f8\u76ee\u524d\u91c7\u7528\u7684\u81ea\u7814\u5f00\u53d1\u6846\u67b6\uff0c\u8fd9\u4e2a\u662f\u6700\u987a\u624b\u7684\uff0c\u4f46\u95ee\u9898\u662f\uff0c\u6211\u5c31\u662f\u5e72\u8fd9\u4e48\u4e2a\u5c0f\u6d3b\u513f\uff0c\u4e0d\u81f3\u4e8e\u6740\u9e21\u7528\u725b\u5200\u3002\u55ef\uff0c\u90a3\u5c31\u91c7\u7528\u7b2c\u4e09\u65b9\u7684\u6846\u67b6\uff0c\u5e76\u8fc5\u901f\u7684\u9501\u5b9a\u4e86 `sanic` \u6846\u67b6\u3002\n\n`sanic` \u662f\u4e00\u4e2a\u6bd4\u8f83\u65b0\u7684\uff0c\u4f46\u662f\u53d1\u5c55\u6bd4\u8f83\u5feb\u7684\u6846\u67b6\u3002\u5176\u7279\u5f81\u662f\u901f\u5ea6\u975e\u5e38\u5feb\u3002\u636e\u4ed6\u4eec\u5b98\u65b9\u7f51\u7ad9\u81ea\u5df1\u8bf4\uff0c`sanic` \u662f\u6700\u5feb\u7684 `python` \u6846\u67b6\u3002\n\n>`sanic` \u5b98\u65b9\u6587\u6863\u5730\u5740\uff1ahttp:\/\/sanic.readthedocs.io\/en\/latest\/\n\n\u5f00\u5e72\u3002\n\n### \u6700\u7ec8\u4ee3\u7801\n\n```python\n#!\/usr\/bin\/env python3\n# -*- coding: UTF-8 -*-\nfrom sanic import Sanic\nfrom sanic.response import json, text, file\nimport os, sys\nimport hashlib\nimport base64\n\napp = Sanic()\n# \u56fe\u7247\u5b58\u50a8\u76ee\u5f55\nbaseDir = sys.path[0] + '\/image\/'\n# \u6821\u9a8c Token \u5199\u6b7b\u5c31\u6210\uff0c\u53cd\u6b63\u81ea\u5df1\u7528\u7684\u561b\ntoken = 'SheIsABeautifulGirl'\n# \u5141\u8bb8\u7684\u57df\u540d\u5217\u8868\nallowHost = [\n            'localhost',\n            'ilovethisword',\n            'i.fengcss.com',\n            'blog.csdn.net'\n        ]\n\n# \u6210\u529f\u8fd4\u56de\u65b9\u6cd5\ndef ok(data):\n    if type(data) == list:\n        return json({\"data\": {\"list\": data}, \"status\": 0})\n    else:\n        return json({\"data\": data, \"status\": 0})\n# \u5931\u8d25\u8fd4\u56de\u65b9\u6cd5\ndef fail(data):\n    return json({\"data\": data, \"status\": 1})\n\n# \u83b7\u53d6\u56fe\u7247\u540e\u7f00\u540d\ndef getSuffix(filename):\n    tempArr = filename.split('.')\n    suffix = tempArr[-1]\n    fileType = ['jpg', 'jpeg', 'gif', 'png']\n    if len(tempArr) < 2:\n        return 'error name'\n    elif suffix not in fileType:\n        return 'error type'\n    else:\n        return suffix\n# \u68c0\u67e5\u8bf7\u6c42\u5730\u5740\u662f\u5426\u6388\u6743\ndef checkHost(host):\n    for i in allowHost:\n        if i in host:\n            return True\n    return False\n\n# \u4e0a\u4f20\u56fe\u7247\u6587\u4ef6\u63a5\u53e3\n@app.route('\/api\/v1\/upimg', methods=['POST'])\nasync def upimg(request):\n    # \u5224\u65ad\u7528\u6237\u662f\u5426\u5177\u6709\u4e0a\u4f20\u6743\u9650\n    if request.headers.get('token') != token:\n        return fail('\u60a8\u6ca1\u6709\u4f7f\u7528\u672c\u670d\u52a1\u7684\u6743\u9650')\n    image = request.files.get('file').body\n    # \u5224\u65ad\u6587\u4ef6\u662f\u5426\u652f\u6301\n    imageName = request.files.get('file').name\n    imageSuffix = getSuffix(imageName)\n    if 'error' in imageSuffix:\n        return fail(imageSuffix)\n    # \u7ec4\u7ec7\u56fe\u7247\u5b58\u50a8\u8def\u5f84\n    m1 = hashlib.md5()\n    m1.update(image)\n    md5Name = m1.hexdigest()\n    \n    # \u7528 md5 \u7684\u524d\u4e24\u4f4d\u6765\u5efa\u6587\u4ef6\u5939\uff0c\u9632\u6b62\u5355\u4e2a\u6587\u4ef6\u5939\u4e0b\u56fe\u7247\u8fc7\u591a\uff0c\u53c8\u6216\u8005\u6839\u76ee\u5f55\u4e0b\u5efa\u7acb\u592a\u591a\u7684\u6587\u4ef6\u5939\n    saveDir = baseDir + md5Name[0:2] + '\/'\n    savePath = saveDir + md5Name[2:] + '.' + imageSuffix\n    resPath = '\/' + md5Name[0:2] + '\/' + md5Name[2:] + '.' + imageSuffix\n\n    # \u5982\u679c\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\uff0c\u5c31\u521b\u5efa\u6587\u4ef6\u5939\n    if not os.path.exists(saveDir):\n        os.makedirs(saveDir)\n\n    # \u5c06\u6587\u4ef6\u5199\u5165\u5230\u786c\u76d8\n    tempFile = open(savePath, 'wb')\n    tempFile.write(image)\n    tempFile.close()\n\n    # \u7ed9\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\n    return ok({\"path\": resPath})\n\n# \u8bf7\u6c42\u56fe\u7247\u63a5\u53e3\n@app.route('\/', methods=['GET'])\nasync def img(request):\n    # \u5224\u65ad\u662f\u5426\u4e3a\u7f51\u7ad9\u8bf7\u6c42\uff0c\u5426\u5219\u5c31\u52a0\u4e0a\u81ea\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\uff08\u5141\u8bb8\u672c\u5730\u8bbf\u95ee\uff09\n    host = request.headers.get('referer') or 'ilovethisword'\n    # \u5224\u65ad\u8bf7\u6c42\u63a5\u53e3\u662f\u5426\u5e26\u53c2\u6570\uff0c\u5426\u5219\u52a0\u4e0a\u81ea\u5b9a\u4e49\u5b57\u7b26\u4e32\uff08\u6ca1\u6709\u8fd9\u4e2a\u6587\u4ef6\u5939\uff0c\u8fd4\u56de404\uff09\n    args = request.args.get('path') or 'ilovemywife'\n    # \u62fc\u63a5\u6587\u4ef6\u5730\u5740\n    path = baseDir + args\n    # \u5982\u679c\u4e0d\u5728\u5141\u8bb8\u5217\u8868\uff0c\u5219\u5c55\u793a 401 \u56fe\u7247\n    if not checkHost(host):\n        path = baseDir + '\/7b\/e49a54f761da42174d6121fa13e0b3.png'\n    # \u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u5c55\u793a 404 \u56fe\u7247\n    if not os.path.exists(path):\n        path = baseDir + '\/b4\/74335c3944f42275e3caa13930a9b9.png'\n    # \u8fd4\u56de\u6587\u4ef6\n    return await file(path)\n# \u542f\u52a8\u670d\u52a1\nif __name__ == \"__main__\":\n    app.run(host=\"127.0.0.1\", port=8000)\n```\n\n## \u90e8\u7f72\u56fe\u5e8a\n\n\u7a0b\u5e8f\u5f00\u53d1\u5b8c\u6210\u540e\uff0c\u901a\u8fc7\u672c\u5730\u6d4b\u8bd5\uff0c\u786e\u5b9a\u6ca1\u5565\u95ee\u9898\uff0c\u51b3\u5b9a\u4e0a\u751f\u4ea7\u73af\u5883\u3002\uff08\u5c31\u662f\u653e\u5230\u6211\u7684\u5c0f\u7834\u9a74\u4e0a\u53bb\uff09\n\n`centos 7` \u7cfb\u7edf `yum` \u6e90\u4e2d `python` \u6700\u9ad8\u7248\u672c\u4e3a 3.4 \uff0c\u55ef\uff0c\u5b89\u88c5\u4e00\u4e0b\u3002\u4e0d\u8be6\u8ff0\u4e86\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b[How to Install Python 3.6.4 on CentOS 7](https:\/\/www.rosehosting.com\/blog\/how-to-install-python-3-6-4-on-centos-7\/)\n\n\u641e\u597d\u73af\u5883\u4e4b\u540e\uff0c\u5148\u627e\u4e2a\u5730\u65b9\u628a\u6587\u4ef6\u6751\u4e0a\u3002\u8fd9\u91cc\u6211\u7684\u5b58\u50a8\u4f4d\u7f6e\u662f `\/srv\/py-tuchuang\/run.py`\n\n### \u914d\u7f6e python \u670d\u52a1\n\n\u9996\u5148\uff0c\u6211\u4eec\u4f7f\u7528 `chmod +x \/srv\/py-tuchuang\/run.py` \u547d\u4ee4\uff0c\u8ba9\u7a0b\u5e8f\u5177\u6709\u6267\u884c\u6743\u9650\u3002\n\n\u7136\u540e\uff0c\u6211\u4eec\u7528 `vim \/usr\/lib\/systemd\/system\/py-tuchuang.service` \u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u7a0b\u5e8f\u6587\u4ef6\uff0c\u7136\u540e\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\n\n```shell\n[Unit]\nDescription=Python image upload and download Service\nAfter=network.target\nWants=network.target\n\n[Service]\nType=simple\n# \u7528\u6237\u8981\u914d\u7f6e\u6709\u6587\u4ef6\u8bfb\u5199\u6743\u9650\u7684\uff0c\u5b9e\u5728\u4e0d\u884c\u5c31root\nUser=root\nGroup=root\n# \u91cd\u8981\u7684\u5c31\u662f\u4e0b\u9762\u7684\u8fd9\u53e5\u8bdd\nExecStart=\/srv\/py-tuchuang\/run.py\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u4fdd\u5b58\u9000\u51fa\u4e4b\u540e\uff0c\u6211\u4eec\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5206\u522b\u8bbe\u7f6e\u7acb\u5373\u542f\u52a8\u548c\u5f00\u673a\u542f\u52a8\n\n```shell\n# \u542f\u52a8\u670d\u52a1\nsystemctl start py-tuchuang.service\n# \u5c06\u670d\u52a1\u8bbe\u7f6e\u4e3a\u5f00\u673a\u542f\u52a8\nsystemctl enable py-tuchuang.service\n```\n\n\u597d\uff0c\u4ee5\u4e0a\uff0c\u6211\u4eec\u7684\u670d\u52a1\u5c31\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\u3002\u4f46\u662f\uff0c\u6211\u4eec\u7a0b\u5e8f\u4e2d\u8bbe\u5b9a\u6211\u4eec\u7684\u670d\u52a1\u662f\u8dd1\u5728 `127.0.0.1` \u8fd9\u4e2a `ip` \u4e0a\u7684\u3002\u6240\u4ee5\uff0c\u4ed6\u53ea\u80fd\u8dd1\u5728\u672c\u5730\uff0c\u4f60\u4e0d\u80fd\u8bbf\u95ee\u5230\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u5c42\u4ee3\u7406\u3002\n\n### \u914d\u7f6e nginx \u4ee3\u7406\n\n`nginx` \u662f\u6211\u670d\u52a1\u5668\u4e0a\u73b0\u6210\u7684\uff0c\u6bd5\u7adf\u670d\u52a1\u5668\u4e0d\u662f\u4e3a\u4e86\u4e13\u95e8\u5e72\u8fd9\u4e48\u4e00\u4ef6\u7834\u4e8b\u513f\u561b\u3002\n\n`vim \/etc\/nginx\/nginx.conf` \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u5408\u9002\u4f4d\u7f6e\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\n\n```shell\nserver {\n  server_name __YOU_DOMAIN_IN_HERE__;\n  location \/ {\n    proxy_pass  http:\/\/127.0.0.1:8000;\n  }\n}\n```\n\n\u7136\u540e\u4fdd\u5b58\u9000\u51fa\uff0c\u91cd\u542f `nginx` \u670d\u52a1\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u5566\u3002\n\n## \u4f7f\u7528\u56fe\u5e8a\n\n\u56fe\u5e8a\u5df2\u7ecf\u642d\u5efa\u597d\u4e86\uff0c\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u5462\uff1f\u65b9\u6cd5\u6709\u5f88\u591a\u54e6\uff01\n\n### \u547d\u4ee4\u884c\u4e0a\u4f20\u56fe\u7247\n\n\u5176\u5b9e\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e0a\u4f20\u6587\u4ef6\u4e86\u3002\n\n```shell\ncurl http:\/\/__YOU_DOMAIN_IN_HERE__\/api\/v1\/upimg -F \"file=@__UPFILE__PATH__\" -H \"token: SheIsABeautifulGirl\" -v\n```\n\n\u5c06\u4e0a\u9762\u7684 `__YOU_DOMAIN_IN_HERE__` \u66ff\u6362\u4e3a\u4f60\u7684\u670d\u52a1\u57df\u540d\uff0c `__UPFILE__PATH__` \u4fee\u6539\u4e3a\u4f60\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u7136\u540e\uff0c\u5c31\u53ef\u4ee5\u4e0a\u4f20\u6587\u4ef6\u5566~\n\n\u518d\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u5b8c\u5168\u53ef\u4ee5\u5566\u3002\u4e0d\u8fc7\u8fd8\u662f\u7834\u70e6\u3002\n\n### \u81ea\u5df1\u5199\u4e00\u4e2a\u524d\u7aef\u9875\u9762\uff0c\u4e13\u95e8\u7528\u6765\u4e0a\u4f20\n\n...\u7701\u7565\n\n> \u7528 `jquery` \u6216\u8005 `vue` \u6216\u8005\u5176\u4ed6\u4ec0\u4e48\uff0c\u5199\u4e00\u4e2a\u4e0a\u4f20\u6587\u4ef6\u7684\u524d\u7aef\u811a\u672c\u8fd8\u662f\u4e0d\u96be\u7684\uff0c\u4e0d\u8fc7\u4e0d\u5728\u672c\u6587\u8ba8\u8bba\u8303\u56f4\u4e4b\u5185\u3002\n\n### \u914d\u7f6e MWeb \u7f16\u8f91\u5668\u56fe\u5e8a\n\n\u5982\u4e0b\u56fe\u914d\u7f6e MWeb \u7f16\u8f91\u5668\uff0c\u7136\u540e\u5728\u91cc\u9762\u5199\u6587\u7ae0\u7684\u65f6\u5019\uff0c\u5c31\u592aTM\u65b9\u4fbf\u5566\u3002\u968f\u4fbf\u4e00\u4e2a\u5c4f\u5e55\u622a\u56fe\uff0c\u4e5f\u4e0d\u9700\u8981\u4fdd\u5b58\uff0c\u76f4\u63a5\u5230\u7f16\u8f91\u5668\u4e2d\u7c98\u8d34\uff0c\u5c31\u4f1a\u81ea\u52a8\u4e0a\u4f20\uff0c\u5e76\u83b7\u53d6\u5730\u5740\uff0c\u53d8\u6210 markdown \u4ee3\u7801\u5b58\u597d\u3002\n\n![20180614104107](https:\/\/raw.githubusercontent.com\/fengcms\/articles\/master\/image\/7f\/bd8f43f8166b9b14f3e024996ffa4d.png)\n\n\u672c\u5730\u56fe\u7247\u4e5f\u662f\u975e\u5e38\u65b9\u4fbf\uff0c\u76f4\u63a5\u5f80\u7f16\u8f91\u5668\u4e2d\u4e00\u62d6\u52a8\uff0c\u5c31\u53ef\u4ee5\u4e86\u3002\n\n\u597d\uff0c\u8fd9\u5c31\u662f\u672c\u4eba\u81ea\u5df1\u641e\u4e00\u4e2a\u79c1\u4eba\u56fe\u5e8a\u670d\u52a1\u5668\u7684\u5168\u90e8\u8fc7\u7a0b\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u6240\u5e2e\u52a9\u3002\n\n\u672c\u6587\u7531 FungLeo \u539f\u521b\uff0c\u5141\u8bb8\u8f6c\u8f7d\uff0c\u4f46\u8f6c\u8f7d\u5fc5\u987b\u4fdd\u7559\u9996\u53d1\u94fe\u63a5\u3002\n\n\n","private":0,"tags":"python,sanic,\u6587\u4ef6\u4e0a\u4f20,\u56fe\u7247\u9632\u76d7\u94fe,centos \u670d\u52a1\u811a\u672c","categories":"python3,Linux\\CentOS","channel":"31","type":"original","status":1},"error":"","status":true}