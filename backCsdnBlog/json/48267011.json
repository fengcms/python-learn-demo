{"data":{"id":"48267011","title":"[\u8f6c] \u4e3b\u6d41JS\u6846\u67b6\u4e2dDOMReady\u4e8b\u4ef6\u7684\u5b9e\u73b0","articleedittype":1,"description":"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u573a\u666f\uff0c\u5f53\u9875\u9762\u52a0\u8f7d\u5b8c\u6210\u540e\u53bb\u505a\u4e00\u4e9b\u4e8b\u60c5\uff1a\u7ed1\u5b9a\u4e8b\u4ef6\u3001DOM\u64cd\u4f5c\u67d0\u4e9b\u7ed3\u70b9\u7b49\u3002\u539f\u6765\u6bd4\u8f83\u5e38\u7528\u7684\u662fwindow\u7684onload \u4e8b\u4ef6\uff0c\u800c\u8be5\u4e8b\u4ef6\u7684\u5b9e\u9645\u6548\u679c\u662f\uff1a\u5f53\u9875\u9762\u89e3\u6790\/DOM\u6811\u5efa\u7acb\u5b8c\u6210\uff0c\u5e76\u5b8c\u6210\u4e86\u8bf8\u5982\u56fe\u7247\u3001\u811a\u672c\u3001\u6837\u5f0f\u8868\u751a\u81f3\u662fiframe\u4e2d\u6240\u6709\u8d44\u6e90\u7684\u4e0b\u8f7d\u540e\u624d\u89e6\u53d1\u7684\u3002\u8fd9\u5bf9\u4e8e\u5f88\u591a \u5b9e\u9645\u7684\u5e94\u7528\u800c\u8a00\u6709\u70b9\u592a\u201c\u8fdf\u201d\u4e86\uff0c\u6bd4\u8f83\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cff\u4e2d\u4fbf\u589e\u52a0\u4e86\u4e00\u4e2aDOMContentLoa","content":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u573a\u666f\uff0c\u5f53\u9875\u9762\u52a0\u8f7d\u5b8c\u6210\u540e\u53bb\u505a\u4e00\u4e9b\u4e8b\u60c5\uff1a\u7ed1\u5b9a\u4e8b\u4ef6\u3001DOM\u64cd\u4f5c\u67d0\u4e9b\u7ed3\u70b9\u7b49\u3002\u539f\u6765\u6bd4\u8f83\u5e38\u7528\u7684\u662fwindow\u7684onload \u4e8b\u4ef6\uff0c\u800c\u8be5\u4e8b\u4ef6\u7684\u5b9e\u9645\u6548\u679c\u662f\uff1a\u5f53\u9875\u9762\u89e3\u6790\/DOM\u6811\u5efa\u7acb\u5b8c\u6210\uff0c\u5e76\u5b8c\u6210\u4e86\u8bf8\u5982\u56fe\u7247\u3001\u811a\u672c\u3001\u6837\u5f0f\u8868\u751a\u81f3\u662fiframe\u4e2d\u6240\u6709\u8d44\u6e90\u7684\u4e0b\u8f7d\u540e\u624d\u89e6\u53d1\u7684\u3002\u8fd9\u5bf9\u4e8e\u5f88\u591a \u5b9e\u9645\u7684\u5e94\u7528\u800c\u8a00\u6709\u70b9\u592a\u201c\u8fdf\u201d\u4e86\uff0c\u6bd4\u8f83\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cff\u4e2d\u4fbf\u589e\u52a0\u4e86\u4e00\u4e2aDOMContentLoaded\u65b9\u6cd5\uff0c\u4e0eonload\u76f8\u6bd4\uff0c\u8be5 \u65b9\u6cd5\u89e6\u53d1\u7684\u65f6\u95f4\u66f4\u65e9\uff0c\u5b83\u662f\u5728\u9875\u9762\u7684DOM\u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210\u540e\u5373\u89e6\u53d1\uff0c\u800c\u65e0\u9700\u7b49\u5f85\u5176\u4ed6\u8d44\u6e90\u7684\u52a0\u8f7d\u3002Webkit\u5f15\u64ce\u4ece\u7248\u672c525\uff08Webkit nightly 1\/2008:525+\uff09\u5f00\u59cb\u4e5f\u5f15\u5165\u4e86\u8be5\u4e8b\u4ef6\uff0cOpera\u4e2d\u4e5f\u5305\u542b\u8be5\u65b9\u6cd5\u3002\u5230\u76ee\u524d\u4e3a\u6b62\u4e3b\u6d41\u7684IE\u4ecd\u7136\u6ca1\u6709\u8981\u6dfb\u52a0\u7684\u610f\u601d\u3002\u867d\u7136IE\u4e0b\u6ca1\u6709\uff0c\u4f46\u603b\u662f\u6709\u89e3\u51b3\u529e\u6cd5 \u7684\uff0c\u4e0b\u6587\u5bf9\u6bd4\u4e86\u4e00\u4e0b\u51e0\u5927\u4e3b\u6d41\u6846\u67b6\u5bf9\u4e8e\u8be5\u4e8b\u4ef6\u7684\u517c\u5bb9\u6027\u7248\u672c\u5b9e\u73b0\u65b9\u6848\uff0c\u6d89\u53ca\u7684\u6846\u67b6\u5305\u62ec\uff1a<\/p>\n\n<ol>\n<li>Prototype<\/li>\n<li>jQeury<\/li>\n<li>moontools<\/li>\n<li>dojo<\/li>\n<li>yui<\/li>\n<li>ext<\/li>\n<\/ol>\n\n<h2 id=\"\u4e00prototype\">\u4e00\u3001Prototype<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs lisp\"><span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span> {\n    \/<span class=\"hljs-variable\">* Support for the DOMContentLoaded event is based on work by Dan Webb,\nMatthias Miller, Dean Edwards and John Resig. *<\/span>\/\n    var timer<span class=\"hljs-comment\">;<\/span>\n    function fireContentLoadedEvent<span class=\"hljs-list\">()<\/span> {\n        if <span class=\"hljs-list\">(<span class=\"hljs-title\">document<\/span>.loaded)<\/span> return<span class=\"hljs-comment\">;<\/span>\n        if <span class=\"hljs-list\">(<span class=\"hljs-title\">timer<\/span>)<\/span> window.clearInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">timer<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        document.fire<span class=\"hljs-list\">(<span class=\"hljs-string\">\"dom:loaded\"<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        document.loaded = true<span class=\"hljs-comment\">;<\/span>\n    }\n    if <span class=\"hljs-list\">(<span class=\"hljs-title\">document<\/span>.addEventListener)<\/span> {\n        if <span class=\"hljs-list\">(<span class=\"hljs-title\">Prototype<\/span>.Browser.WebKit)<\/span> {\n            timer = window.setInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span> {\n                if <span class=\"hljs-list\">(<span class=\"hljs-title\">\/loaded<\/span>|complete\/.test<span class=\"hljs-list\">(<span class=\"hljs-title\">document<\/span>.readyState)<\/span>)<\/span>\n                    fireContentLoadedEvent<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n            }, <span class=\"hljs-number\">0<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n            Event.observe<span class=\"hljs-list\">(<span class=\"hljs-title\">window<\/span>, <span class=\"hljs-string\">\"load\"<\/span>, fireContentLoadedEvent)<\/span><span class=\"hljs-comment\">;<\/span>\n        } else {\n            document.addEventListener<span class=\"hljs-list\">(<span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>,\n                fireContentLoadedEvent, false)<\/span><span class=\"hljs-comment\">;<\/span>\n        }\n    } else {\n        document.write<span class=\"hljs-list\">(<span class=\"hljs-string\">\"&lt;\"<\/span>+<span class=\"hljs-string\">\"script id=__onDOMContentLoaded defer src=\/\/:&gt;&lt;\\\/script&gt;\"<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        $<span class=\"hljs-list\">(<span class=\"hljs-string\">\"__onDOMContentLoaded\"<\/span>)<\/span>.onreadystatechange = function<span class=\"hljs-list\">()<\/span> {\n            if <span class=\"hljs-list\">(<span class=\"hljs-title\">this<\/span>.readyState == <span class=\"hljs-string\">\"complete\"<\/span>)<\/span> {\n                this.onreadystatechange = null<span class=\"hljs-comment\">;<\/span>\n                fireContentLoadedEvent<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n            }\n        }<span class=\"hljs-comment\">;<\/span>\n    }\n})<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span><\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a<\/p>\n\n<ol>\n<li>\u5982\u679c\u662fwebkit\u5219\u8f6e\u8be2document\u7684readyState\u5c5e\u6027\uff0c\u5982\u679c\u8be5\u5c5e\u6027\u7684\u503c\u4e3aloaded\u6216complete\u5219\u89e6\u53d1DOMContentLoaded\u4e8b\u4ef6\uff0c\u4e3a\u4fdd\u9669\u8d77\u89c1\uff0c\u5c06\u8be5\u4e8b\u4ef6\u6ce8\u518c\u5230window.onload\u4e0a\u3002<\/li>\n<li>\u5982\u679c\u662fFF\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6\u3002<\/li>\n<li>\u5982\u679c\u662fIE\u5219\u4f7f\u7528document.write\u5f80\u9875\u9762\u4e2d\u52a0\u5165\u4e00\u4e2ascript\u5143\u7d20\uff0c\u5e76\u8bbe\u7f6edefer\u5c5e\u6027\uff0c\u6700\u540e\u662f\u628a\u8be5\u811a\u672c\u7684\u52a0\u8f7d\u5b8c\u6210\u89c6\u4f5cDOMContentLoaded\u4e8b\u4ef6\u6765\u89e6\u53d1\u3002<\/li>\n<\/ol>\n\n<p>\u8be5\u5b9e\u73b0\u65b9\u5f0f\u7684\u95ee\u9898\u4e3b\u8981\u6709\u4e24\u70b9\uff1a\u7b2c\u4e00\u3001\u901a\u8fc7document.write\u5199script\u5e76\u8bbe\u7f6edefer\u7684\u65b9\u6cd5\u5728\u9875\u9762\u5305\u542biframe\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u7b49\u5230 iframe\u5185\u7684\u5185\u5bb9\u52a0\u8f7d\u5b8c\u540e\u624d\u89e6\u53d1\uff0c\u8fd9\u4e0eonload\u6ca1\u6709\u592a\u5927\u7684\u533a\u522b\uff1b\u7b2c\u4e8c\u3001Webkit\u5728525\u4ee5\u4e0a\u7684\u7248\u672c\u5f15\u5165\u4e86DOMContentLoaded\u65b9 \u6cd5\uff0c\u56e0\u6b64\u5728\u8fd9\u4e9b\u7248\u672c\u4e2d\u65e0\u9700\u518d\u901a\u8fc7\u8f6e\u8be2\u6765\u5b9e\u73b0\uff0c\u53ef\u4ee5\u4f18\u5316\u3002<\/p>\n\n<h2 id=\"\u4e8cjquery\">\u4e8c\u3001jQuery<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs coffeescript\"><span class=\"hljs-reserved\">function<\/span> bindReady(){\n    <span class=\"hljs-keyword\">if<\/span> ( readyBound ) <span class=\"hljs-keyword\">return<\/span>;\n    readyBound = <span class=\"hljs-literal\">true<\/span>;\n    <span class=\"hljs-regexp\">\/\/<\/span> Mozilla, Opera <span class=\"hljs-keyword\">and<\/span> webkit nightlies currently support <span class=\"hljs-keyword\">this<\/span> event\n     <span class=\"hljs-keyword\">if<\/span> ( <span class=\"hljs-built_in\">document<\/span>.addEventListener ) {\n        <span class=\"hljs-regexp\">\/\/<\/span> Use the handy event callback\n         <span class=\"hljs-built_in\">document<\/span>.addEventListener( <span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, <span class=\"hljs-reserved\">function<\/span>(){\n            <span class=\"hljs-built_in\">document<\/span>.removeEventListener( <span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, arguments.callee, <span class=\"hljs-literal\">false<\/span> );\n            jQuery.ready();\n        }, <span class=\"hljs-literal\">false<\/span> );\n    <span class=\"hljs-regexp\">\/\/<\/span> If IE event model <span class=\"hljs-keyword\">is<\/span> used\n    } <span class=\"hljs-keyword\">else<\/span> <span class=\"hljs-keyword\">if<\/span> ( <span class=\"hljs-built_in\">document<\/span>.attachEvent ) {\n        <span class=\"hljs-regexp\">\/\/<\/span> ensure firing before onload,\n        <span class=\"hljs-regexp\">\/\/<\/span> maybe late but safe also <span class=\"hljs-keyword\">for<\/span> iframes\n        <span class=\"hljs-built_in\">document<\/span>.attachEvent(<span class=\"hljs-string\">\"onreadystatechange\"<\/span>, <span class=\"hljs-reserved\">function<\/span>(){\n            <span class=\"hljs-keyword\">if<\/span> ( <span class=\"hljs-built_in\">document<\/span>.readyState === <span class=\"hljs-string\">\"complete\"<\/span> ) {\n                <span class=\"hljs-built_in\">document<\/span>.detachEvent( <span class=\"hljs-string\">\"onreadystatechange\"<\/span>, arguments.callee );\n                jQuery.ready();\n            }\n        });\n        <span class=\"hljs-regexp\">\/\/<\/span> If IE <span class=\"hljs-keyword\">and<\/span> <span class=\"hljs-keyword\">not<\/span> an iframe\n        <span class=\"hljs-regexp\">\/\/<\/span> continually check to see <span class=\"hljs-keyword\">if<\/span> the <span class=\"hljs-built_in\">document<\/span> <span class=\"hljs-keyword\">is<\/span> ready\n        <span class=\"hljs-keyword\">if<\/span> ( <span class=\"hljs-built_in\">document<\/span>.documentElement.doScroll &amp;&amp; <span class=\"hljs-keyword\">typeof<\/span> <span class=\"hljs-built_in\">window<\/span>.frameElement === <span class=\"hljs-string\">\"undefined\"<\/span> ) (<span class=\"hljs-reserved\">function<\/span>(){\n            <span class=\"hljs-keyword\">if<\/span> ( jQuery.isReady ) <span class=\"hljs-keyword\">return<\/span>;\n            <span class=\"hljs-keyword\">try<\/span> {\n                <span class=\"hljs-regexp\">\/\/<\/span> If IE <span class=\"hljs-keyword\">is<\/span> used, use the trick <span class=\"hljs-keyword\">by<\/span> Diego Perini\n                <span class=\"hljs-regexp\">\/\/<\/span> <span class=\"hljs-attribute\">http<\/span>:<span class=\"hljs-regexp\">\/\/<\/span>javascript.nwbox.com<span class=\"hljs-regexp\">\/IEContentLoaded\/<\/span>\n                <span class=\"hljs-built_in\">document<\/span>.documentElement.doScroll(<span class=\"hljs-string\">\"left\"<\/span>);\n            } <span class=\"hljs-keyword\">catch<\/span>( error ) {\n                setTimeout( arguments.callee, <span class=\"hljs-number\">0<\/span> );\n                <span class=\"hljs-keyword\">return<\/span>;\n            }\n            <span class=\"hljs-regexp\">\/\/<\/span> <span class=\"hljs-keyword\">and<\/span> execute any waiting functions\n            jQuery.ready();\n        })();\n    }\n    <span class=\"hljs-regexp\">\/\/<\/span> A fallback to <span class=\"hljs-built_in\">window<\/span>.onload, that will always work\n    jQuery.event.add( <span class=\"hljs-built_in\">window<\/span>, <span class=\"hljs-string\">\"load\"<\/span>, jQuery.ready );\n}<\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a<\/p>\n\n<ol>\n<li>\u5c06Webkit\u4e0eFirefox\u540c\u7b49\u5bf9\u5f85\uff0c\u90fd\u662f\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6\uff0c\u4f46\u662f\u7531\u4e8eWebkit\u662f\u5728525\u4ee5\u4e0a\u7248\u672c\u624d\u5f15\u5165\u7684\uff0c\u56e0\u6b64\u5b58\u5728\u517c\u5bb9\u6027\u7684\u9690\u60a3\u3002<\/li>\n<li>\u5bf9\u4e8eIE\uff0c\u9996\u5148\u6ce8\u518cdocument\u7684onreadystatechange\u4e8b\u4ef6\uff0c\u7ecf\u6d4b\u8bd5\uff0c\u8be5\u65b9\u5f0f\u4e0ewindow.onload\u76f8\u5f53\uff0c\u4f9d\u7136\u4f1a\u7b49\u5230\u6240\u6709\u8d44\u6e90\u4e0b\u8f7d\u5b8c\u6bd5\u540e\u624d\u89e6\u53d1\u3002<\/li>\n<li>\u4e4b\u540e\uff0c\u5224\u65ad\u5982\u679c\u662fIE\u5e76\u4e14\u9875\u9762\u4e0d\u5728iframe\u5f53\u4e2d\uff0c\u5219\u901a\u8fc7setTiemout\u6765\u4e0d\u65ad\u7684\u8c03\u7528documentElement\u7684doScroll\u65b9\u6cd5\uff0c\u76f4\u5230\u8c03\u7528\u6210\u529f\u5219\u51fa\u89e6\u53d1DOMContentLoaded<\/li>\n<\/ol>\n\n<p>jQuery\u5bf9\u4e8eIE\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f7f\u7528\u4e86\u4e00\u79cd\u65b0\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u6e90\u81ea<a href=\"http:\/\/javascript.nwbox.com\/IEContentLoaded\/\">http:\/\/javascript.nwbox.com\/IEContentLoaded\/<\/a>\u3002 \u5b83\u7684\u539f\u7406\u662f\uff0c\u5728IE\u4e0b\uff0cDOM\u7684\u67d0\u4e9b\u65b9\u6cd5\u53ea\u6709\u5728DOM\u89e3\u6790\u5b8c\u6210\u540e\u624d\u53ef\u4ee5\u8c03\u7528\uff0cdoScroll\u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53cd\u8fc7\u6765\u5f53\u80fd\u8c03\u7528doScroll\u7684\u65f6\u5019\u5373 \u662fDOM\u89e3\u6790\u5b8c\u6210\u4e4b\u65f6\uff0c\u4e0eprototype\u4e2d\u7684document.write\u76f8\u6bd4\uff0c\u8be5\u65b9\u6848\u53ef\u4ee5\u89e3\u51b3\u9875\u9762\u6709iframe\u65f6\u5931\u6548\u7684\u95ee\u9898\u3002\u6b64\u5916\uff0cjQuery \u4f3c\u4e4e\u62c5\u5fc3\u5f53\u9875\u9762\u5904\u4e8eiframe\u4e2d\u65f6\uff0c\u8be5\u65b9\u6cd5\u4f1a\u5931\u6548\uff0c\u56e0\u6b64\u5b9e\u73b0\u4ee3\u7801\u4e2d\u505a\u4e86\u5224\u65ad\uff0c\u5982\u679c\u662f\u5728iframe\u4e2d\u5219\u901a\u8fc7document\u7684 onreadystatechange\u6765\u5b9e\u73b0\uff0c\u5426\u5219\u901a\u8fc7doScroll\u6765\u5b9e\u73b0\u3002\u4e0d\u8fc7\u7ecf\u6d4b\u8bd5\uff0c\u5373\u4f7f\u662f\u5728iframe\u4e2d\uff0cdoScroll\u4f9d\u7136\u6709\u6548\u3002<\/p>\n\n<h2 id=\"\u4e09moontools\">\u4e09\u3001Moontools<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs clojure\"><span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-collection\">{\n    var domready = function<span class=\"hljs-list\">()<\/span><span class=\"hljs-collection\">{\n        if <span class=\"hljs-list\">(<span class=\"hljs-title\">Browser.loaded<\/span>)<\/span> return<span class=\"hljs-comment\">;<\/span>\n        Browser.loaded = true<span class=\"hljs-comment\">;<\/span>\n        window.fireEvent<span class=\"hljs-list\">(<span class=\"hljs-title\">'domready'<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        document.fireEvent<span class=\"hljs-list\">(<span class=\"hljs-title\">'domready'<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n    }<\/span><span class=\"hljs-comment\">;<\/span>\n    if <span class=\"hljs-list\">(<span class=\"hljs-title\">Browser.Engine.trident<\/span>)<\/span><span class=\"hljs-collection\">{\n        var temp = document.createElement<span class=\"hljs-list\">(<span class=\"hljs-title\">'div'<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        <span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-collection\">{\n            <span class=\"hljs-list\">(<span class=\"hljs-title\">$try<\/span><span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-collection\">{\n                temp.doScroll<span class=\"hljs-list\">(<span class=\"hljs-title\">'left'<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n                return $<span class=\"hljs-list\">(<span class=\"hljs-title\">temp<\/span>)<\/span>.inject<span class=\"hljs-list\">(<span class=\"hljs-title\">document.body<\/span>)<\/span>.set<span class=\"hljs-list\">(<span class=\"hljs-title\">'html'<\/span>, 'temp')<\/span>.dispose<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n            }<\/span>)<\/span>)<\/span> ? domready<span class=\"hljs-list\">()<\/span> : arguments.callee.delay<span class=\"hljs-list\">(<span class=\"hljs-title\">50<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        }<\/span>)<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n    }<\/span> else if <span class=\"hljs-list\">(<span class=\"hljs-title\">Browser.Engine.webkit<\/span> &amp;&amp; Browser.Engine.version &lt;<span class=\"hljs-number\"> 525<\/span>)<\/span><span class=\"hljs-collection\">{\n        <span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-collection\">{\n            <span class=\"hljs-list\">(<span class=\"hljs-collection\">['loaded', 'complete']<\/span>.contains<span class=\"hljs-list\">(<span class=\"hljs-title\">document.readyState<\/span>)<\/span>)<\/span> ? domready<span class=\"hljs-list\">()<\/span> : arguments.callee.delay<span class=\"hljs-list\">(<span class=\"hljs-title\">50<\/span>)<\/span><span class=\"hljs-comment\">;<\/span>\n        }<\/span>)<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n    }<\/span> else <span class=\"hljs-collection\">{\n        window.addEvent<span class=\"hljs-list\">(<span class=\"hljs-title\">'load'<\/span>, domready)<\/span><span class=\"hljs-comment\">;<\/span>\n        document.addEvent<span class=\"hljs-list\">(<span class=\"hljs-title\">'DOMContentLoaded'<\/span>, domready)<\/span><span class=\"hljs-comment\">;<\/span>\n    }<\/span>\n}<\/span>)<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span><\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a<\/p>\n\n<ol>\n<li>\u5982\u679c\u662fIE\u5219\u4f7f\u7528doScroll\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002<\/li>\n<li>\u5982\u679c\u662f\u5c0f\u4e8e525\u7248\u672c\u7684Webkit\u5219\u901a\u8fc7\u8f6e\u8be2document.readyState\u6765\u5b9e\u73b0\u3002<\/li>\n<li>\u5176\u4ed6\u7684(FF\/Webkit\u9ad8\u7248\/Opera)\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6<\/li>\n<\/ol>\n\n<p>Moontools\u7684\u5b9e\u73b0\u65b9\u6848prototype\u548cjQeury\u4e2d\u7684\u7efc\u5408\u4f53\uff0c\u5bf9webkit\u505a\u4e86\u7248\u672c\u5224\u65ad\u5219\u4f7f\u5f97\u8be5\u65b9\u6848\u66f4\u52a0\u7684\u5065\u58ee\u3002\u5728doScroll\u7684\u5b9e\u73b0\u65b9\u9762\uff0c\u4e0ejQuery\u76f8\u6bd4\uff0c\u8fd9\u91cc\u662f\u65b0\u5efa\u4e86\u4e00\u4e2adiv\u5143\u7d20\uff0c\u5e76\u4e14\u5728\u4f7f\u7528\u5b8c\u6bd5\u540e\u8fdb\u884c\u9500\u6bc1\uff0c\u800cjQuery\u5219\u76f4\u63a5\u4f7f\u7528\u4e86documentElement\u7684 doScroll\u6765\u68c0\u6d4b\uff0c\u66f4\u7b80\u5355\u9ad8\u6548\u4e00\u4e9b\u3002<\/p>\n\n<h2 id=\"\u56dbdojo\">\u56db\u3001Dojo<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs javascript\"><span class=\"hljs-comment\">\/\/ START DOMContentLoaded<\/span>\n<span class=\"hljs-comment\">\/\/ Mozilla and Opera 9 expose the event we could use<\/span>\n<span class=\"hljs-keyword\">if<\/span>(document.addEventListener){\n    <span class=\"hljs-comment\">\/\/ NOTE:<\/span>\n    <span class=\"hljs-comment\">\/\/  due to a threading issue in Firefox 2.0, we can't enable<\/span>\n    <span class=\"hljs-comment\">\/\/  DOMContentLoaded on that platform. For more information, see:<\/span>\n    <span class=\"hljs-comment\">\/\/  http:\/\/trac.dojotoolkit.org\/ticket\/1704<\/span>\n    <span class=\"hljs-keyword\">if<\/span>(dojo.isOpera || dojo.isFF &gt;= <span class=\"hljs-number\">3<\/span> || (dojo.isMoz &amp;&amp; dojo.config.enableMozDomContentLoaded === <span class=\"hljs-literal\">true<\/span>)){\n        document.addEventListener(<span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, dojo._loadInit, <span class=\"hljs-literal\">null<\/span>);\n    }\n    <span class=\"hljs-comment\">\/\/ mainly for Opera 8.5, won't be fired if DOMContentLoaded fired already.<\/span>\n    <span class=\"hljs-comment\">\/\/  also used for Mozilla because of trac #1640<\/span>\n    window.addEventListener(<span class=\"hljs-string\">\"load\"<\/span>, dojo._loadInit, <span class=\"hljs-literal\">null<\/span>);\n}\n<span class=\"hljs-keyword\">if<\/span>(dojo.isAIR){\n    window.addEventListener(<span class=\"hljs-string\">\"load\"<\/span>, dojo._loadInit, <span class=\"hljs-literal\">null<\/span>);\n}<span class=\"hljs-keyword\">else<\/span> <span class=\"hljs-keyword\">if<\/span>(<span class=\"hljs-regexp\">\/(WebKit|khtml)\/i<\/span>.test(navigator.userAgent)){ <span class=\"hljs-comment\">\/\/ sniff<\/span>\n    dojo._khtmlTimer = setInterval(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n        <span class=\"hljs-keyword\">if<\/span>(<span class=\"hljs-regexp\">\/loaded|complete\/<\/span>.test(document.readyState)){\n            dojo._loadInit(); <span class=\"hljs-comment\">\/\/ call the onload handler<\/span>\n        }\n    }, <span class=\"hljs-number\">10<\/span>);\n}\n<span class=\"hljs-comment\">\/\/ END DOMContentLoaded<\/span>\n\n(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n    <span class=\"hljs-keyword\">var<\/span> _w = window;\n    <span class=\"hljs-keyword\">var<\/span> _handleNodeEvent = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">(<span class=\"hljs-comment\">\/*String*\/<\/span>evtName, <span class=\"hljs-comment\">\/*Function*\/<\/span>fp)<\/span>{<\/span>\n        <span class=\"hljs-comment\">\/\/ summary:<\/span>\n        <span class=\"hljs-comment\">\/\/  non-destructively adds the specified function to the node's<\/span>\n        <span class=\"hljs-comment\">\/\/  evtName handler.<\/span>\n        <span class=\"hljs-comment\">\/\/ evtName: should be in the form \"onclick\" for \"onclick\" handlers.<\/span>\n        <span class=\"hljs-comment\">\/\/ Make sure you pass in the \"on\" part.<\/span>\n        <span class=\"hljs-keyword\">var<\/span> oldHandler = _w[evtName] || <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>};\n        _w[evtName] = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n            fp.apply(_w, <span class=\"hljs-built_in\">arguments<\/span>);\n            oldHandler.apply(_w, <span class=\"hljs-built_in\">arguments<\/span>);\n        };\n    };\n    <span class=\"hljs-keyword\">if<\/span>(dojo.isIE){\n        <span class=\"hljs-comment\">\/\/  for Internet Explorer. readyState will not be achieved on init<\/span>\n        <span class=\"hljs-comment\">\/\/  call, but dojo doesn't need it however, we'll include it<\/span>\n        <span class=\"hljs-comment\">\/\/  because we don't know if there are other functions added that<\/span>\n        <span class=\"hljs-comment\">\/\/  might.  Note that this has changed because the build process<\/span>\n        <span class=\"hljs-comment\">\/\/  strips all comments -- including conditional ones.<\/span>\n        <span class=\"hljs-keyword\">if<\/span>(!dojo.config.afterOnLoad){\n            document.write(<span class=\"hljs-string\">'&lt;scr'<\/span>+<span class=\"hljs-string\">'ipt defer=\"\" src=\"\/\/:\" +=\"\" onreadystatechange=\"if(this.readyState==\\'complete\\'){'<\/span> + dojo._scopeName + <span class=\"hljs-string\">'._loadInit();}\"&gt;'<\/span>\n                + <span class=\"hljs-string\">'&lt;\/scr'<\/span>+<span class=\"hljs-string\">'ipt&gt;'<\/span>\n                );\n        }\n        <span class=\"hljs-keyword\">try<\/span>{\n            document.namespaces.add(<span class=\"hljs-string\">\"v\"<\/span>,<span class=\"hljs-string\">\"urn:schemas-microsoft-com:vml\"<\/span>);\n            document.createStyleSheet().addRule(<span class=\"hljs-string\">\"v\\\\:*\"<\/span>, <span class=\"hljs-string\">\"behavior:url(#default#VML)\"<\/span>);\n        }<span class=\"hljs-keyword\">catch<\/span>(e){}\n    }\n    <span class=\"hljs-comment\">\/\/ FIXME: dojo.unloaded requires dojo scope, so using anon function wrapper.<\/span>\n    _handleNodeEvent(<span class=\"hljs-string\">\"onbeforeunload\"<\/span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span> {<\/span>\n        dojo.unloaded();\n    });\n    _handleNodeEvent(<span class=\"hljs-string\">\"onunload\"<\/span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span> {<\/span>\n        dojo.windowUnloaded();\n    });\n})();<\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a<\/p>\n\n<ol>\n<li>\u5982\u679c\u662fOpera\u6216FF3\u4ee5\u4e0a\u7248\u672c\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded&lt;\u4e8b\u4ef6\uff0c\u4e3a\u4fdd\u9669\u8d77\u89c1\uff0c\u540c\u65f6\u4e5f\u6ce8\u518c\u4e86window.onload\u4e8b\u4ef6\u3002<\/li>\n<li>\u5bf9\u4e8ewebkit\u5219\u901a\u8fc7\u8f6e\u8be2document.readyState\u6765\u5b9e\u73b0\u3002<\/li>\n<li>\u5982\u679c\u662fAir\u5219\u53ea\u6ce8\u518cwidnow.onload\u4e8b\u4ef6\u3002<\/li>\n<li>\u5982\u679c\u662fIE\u5219\u901a\u8fc7\u5f80\u9875\u9762\u5199\u5e26defer\u5c5e\u6027\u7684script\u5e76\u6ce8\u518c\u5176onreadystatechange\u4e8b\u4ef6\u6765\u5b9e\u73b0\u3002<\/li>\n<\/ol>\n\n<p>Dojo\u5728IE\u4e0b\u7684\u5b9e\u73b0\u65b9\u6848\u540c\u6837\u65e0\u6cd5\u89e3\u51b3iframe\u7684\u95ee\u9898\uff0c\u800c\u7531\u4e8e\u5728FF2 \u4e0b\u4f1a\u6709\u4e00\u4e2a\u975e\u5e38\u5947\u602a\u7684Bug\uff0c\u56e0\u6b64\u9ed8\u8ba4\u53ea\u5728FF3\u4ee5\u4e0a\u7248\u672c\u4e0a\u4f7f\u7528DOMContentLoaded\u4e8b\u4ef6\uff0c\u540c\u65f6\u53c8\u7ed9\u4e86\u4e00\u4e2a\u914d\u7f6e -dojo.config.enableMozDomContentLoaded\uff0c\u5982\u679c\u5728FF\u4e0b\u5c06\u8be5\u914d\u7f6e\u8bbe\u7f6e\u4e3atrue\u5219\u4f9d\u7136\u4f1a\u4f7f\u7528 DOMContentLoaded\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e00\u70b9\u5145\u5206\u8003\u8651\u5230\u4e86\u7075\u6d3b\u6027\u3002\u5bf9\u4e8ewebkit\u7684\u5b9e\u73b0\uff0c\u4e0eprototype\u4e00\u6837\u6709\u4f18\u5316\u7684\u7a7a\u95f4\u3002<\/p>\n\n<h2 id=\"\u4e94yui\">\u4e94\u3001YUI<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs lisp\"><span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span> {\n    \/<span class=\"hljs-variable\">*! DOMReady: based on work by: Dean Edwards\/John Resig\/Matthias Miller *<\/span>\/\n    \/\/ Internet Explorer: use the readyState of a defered script.\n    \/\/ This isolates what appears to be a safe moment to manipulate\n    \/\/ the DOM prior to when the document's readyState suggests\n    \/\/ it is safe to do so.\n    if <span class=\"hljs-list\">(<span class=\"hljs-title\">EU<\/span>.isIE)<\/span> {\n        \/\/ Process onAvailable\/onContentReady items when the\n        \/\/ DOM is ready.\n        YAHOO.util.Event.onDOMReady<span class=\"hljs-list\">(\n            YAHOO.util.Event._tryPreloadAttach,\n            YAHOO.util.Event, true)<\/span><span class=\"hljs-comment\">;<\/span>\n        var n = document.createElement<span class=\"hljs-list\">('p')<\/span><span class=\"hljs-comment\">;<\/span>\n        EU._dri = setInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span> {\n            try {\n                \/\/ throws an error if doc is not ready\n                n.doScroll<span class=\"hljs-list\">('left')<\/span><span class=\"hljs-comment\">;<\/span>\n                clearInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">EU<\/span>._dri)<\/span><span class=\"hljs-comment\">;<\/span>\n                EU._dri = null<span class=\"hljs-comment\">;<\/span>\n                EU._ready<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n                n = null<span class=\"hljs-comment\">;<\/span>\n            } catch <span class=\"hljs-list\">(<span class=\"hljs-title\">ex<\/span>)<\/span> {\n            }\n        }, EU.POLL_INTERVAL)<\/span><span class=\"hljs-comment\">;<\/span>\n    \/\/ The document's readyState in Safari currently will\n    \/\/ change to loaded\/complete before images are loaded.\n    } else if <span class=\"hljs-list\">(<span class=\"hljs-title\">EU<\/span>.webkit <span class=\"hljs-keyword\">&amp;&amp;<\/span> EU.webkit &lt; <span class=\"hljs-number\">525<\/span>)<\/span> {\n        EU._dri = setInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">function<\/span><span class=\"hljs-list\">()<\/span> {\n            var rs=document.readyState<span class=\"hljs-comment\">;<\/span>\n            if <span class=\"hljs-list\">(<span class=\"hljs-string\">\"loaded\"<\/span> == rs || <span class=\"hljs-string\">\"complete\"<\/span> == rs)<\/span> {\n                clearInterval<span class=\"hljs-list\">(<span class=\"hljs-title\">EU<\/span>._dri)<\/span><span class=\"hljs-comment\">;<\/span>\n                EU._dri = null<span class=\"hljs-comment\">;<\/span>\n                EU._ready<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n            }\n        }, EU.POLL_INTERVAL)<\/span><span class=\"hljs-comment\">;<\/span>\n    \/\/ FireFox and Opera: These browsers provide a event for this\n    \/\/ moment.  The latest WebKit releases now support this event.\n    } else {\n        EU._simpleAdd<span class=\"hljs-list\">(<span class=\"hljs-title\">document<\/span>, <span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, EU._ready)<\/span><span class=\"hljs-comment\">;<\/span>\n    }\n    \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    EU._simpleAdd<span class=\"hljs-list\">(<span class=\"hljs-title\">window<\/span>, <span class=\"hljs-string\">\"load\"<\/span>, EU._load)<\/span><span class=\"hljs-comment\">;<\/span>\n    EU._simpleAdd<span class=\"hljs-list\">(<span class=\"hljs-title\">window<\/span>, <span class=\"hljs-string\">\"unload\"<\/span>, EU._unload)<\/span><span class=\"hljs-comment\">;<\/span>\n    EU._tryPreloadAttach<span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span>\n})<\/span><span class=\"hljs-list\">()<\/span><span class=\"hljs-comment\">;<\/span><\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u4e0eMoontools\u4e00\u6837<\/p>\n\n<h2 id=\"\u516dext\">\u516d\u3001EXT<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs javascript\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span> <span class=\"hljs-title\">initDocReady<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n    <span class=\"hljs-keyword\">var<\/span> COMPLETE = <span class=\"hljs-string\">\"complete\"<\/span>;\n    docReadyEvent = <span class=\"hljs-keyword\">new<\/span> Ext.util.Event();\n    <span class=\"hljs-keyword\">if<\/span> (Ext.isGecko || Ext.isOpera) {\n        DOC.addEventListener(DOMCONTENTLOADED, fireDocReady, <span class=\"hljs-literal\">false<\/span>);\n    } <span class=\"hljs-keyword\">else<\/span> <span class=\"hljs-keyword\">if<\/span> (Ext.isIE){\n        DOC.write(<span class=\"hljs-string\">\"&lt;script id=\"<\/span> + IEDEFERED + <span class=\"hljs-string\">\" defer=defer src='\/%27+%27\/:'&gt;&lt;\/script&gt;\"<\/span>);\n        DOC.getElementById(IEDEFERED).onreadystatechange = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n            <span class=\"hljs-keyword\">if<\/span>(<span class=\"hljs-keyword\">this<\/span>.readyState == COMPLETE){\n                fireDocReady();\n            }\n        };\n    } <span class=\"hljs-keyword\">else<\/span> <span class=\"hljs-keyword\">if<\/span> (Ext.isWebKit){\n        docReadyProcId = setInterval(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n            <span class=\"hljs-keyword\">if<\/span>(DOC.readyState == COMPLETE) {\n                fireDocReady();\n            }\n        }, <span class=\"hljs-number\">10<\/span>);\n    }\n    <span class=\"hljs-comment\">\/\/ no matter what, make sure it fires on load<\/span>\n    E.on(WINDOW, <span class=\"hljs-string\">\"load\"<\/span>, fireDocReady);\n}<\/code><\/pre>\n\n<p>\u5b9e\u73b0\u601d\u8def\u4e0eDojo\u7684\u4e00\u81f4\uff0c\u4e0d\u518d\u8d58\u8bc9\u3002<\/p>\n\n<h2 id=\"\u603b\u7ed3\">\u603b\u7ed3<\/h2>\n\n<p>\u603b\u7ed3\u5404\u5927\u4e3b\u6d41\u6846\u67b6\u7684\u505a\u6cd5\uff0c\u5199\u4e86\u4ee5\u4e0b\u8fd9\u4e2a\u7248\u672c\u3002\u4e3b\u8981\u662f\u5c3d\u91cf\u7684\u505a\u5230\u4f18\u5316\u5e76\u8003\u8651\u5230FF2\u4e0b\u7684Bug\uff0c\u63d0\u4f9b\u4e00\u4e2a\u662f\u5426\u4f7f\u7528DOMContentLoaded\u7684\u5f00\u5173\u914d\u7f6e\u3002<\/p>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs javascript\"><span class=\"hljs-comment\">\/*\n* \u6ce8\u518c\u6d4f\u89c8\u5668\u7684DOMContentLoaded\u4e8b\u4ef6\n* @param { Function } onready [\u5fc5\u586b]\u5728DOMContentLoaded\u4e8b\u4ef6\u89e6\u53d1\u65f6\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\n* @param { Object } config [\u53ef\u9009]\u914d\u7f6e\u9879\n*\/<\/span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span> <span class=\"hljs-title\">onDOMContentLoaded<\/span><span class=\"hljs-params\">(onready,config)<\/span>{<\/span>\n    <span class=\"hljs-comment\">\/\/\u6d4f\u89c8\u5668\u68c0\u6d4b\u76f8\u5173\u5bf9\u8c61\uff0c\u5728\u6b64\u4e3a\u8282\u7701\u4ee3\u7801\u672a\u5b9e\u73b0\uff0c\u5b9e\u9645\u4f7f\u7528\u65f6\u9700\u8981\u5b9e\u73b0\u3002<\/span>\n    <span class=\"hljs-comment\">\/\/var Browser = {};<\/span>\n    <span class=\"hljs-comment\">\/\/\u8bbe\u7f6e\u662f\u5426\u5728FF\u4e0b\u4f7f\u7528DOMContentLoaded\uff08\u5728FF2\u4e0b\u7684\u7279\u5b9a\u573a\u666f\u6709Bug\uff09<\/span>\n    <span class=\"hljs-keyword\">this<\/span>.conf = {\n        enableMozDOMReady:<span class=\"hljs-literal\">true<\/span>\n    };\n    <span class=\"hljs-keyword\">if<\/span>( config )\n        <span class=\"hljs-keyword\">for<\/span>( <span class=\"hljs-keyword\">var<\/span> p <span class=\"hljs-keyword\">in<\/span> config)\n            <span class=\"hljs-keyword\">this<\/span>.conf[p] = config[p];\n    <span class=\"hljs-keyword\">var<\/span> isReady = <span class=\"hljs-literal\">false<\/span>;\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span> <span class=\"hljs-title\">doReady<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n        <span class=\"hljs-keyword\">if<\/span>( isReady ) <span class=\"hljs-keyword\">return<\/span>;\n        <span class=\"hljs-comment\">\/\/\u786e\u4fddonready\u53ea\u6267\u884c\u4e00\u6b21<\/span>\n        isReady = <span class=\"hljs-literal\">true<\/span>;\n        onready();\n    }\n    <span class=\"hljs-comment\">\/*IE*\/<\/span>\n    <span class=\"hljs-keyword\">if<\/span>( Browser.ie ){\n        (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n            <span class=\"hljs-keyword\">if<\/span> ( isReady ) <span class=\"hljs-keyword\">return<\/span>;\n            <span class=\"hljs-keyword\">try<\/span> {\n                document.documentElement.doScroll(<span class=\"hljs-string\">\"left\"<\/span>);\n            } <span class=\"hljs-keyword\">catch<\/span>( error ) {\n                setTimeout( <span class=\"hljs-built_in\">arguments<\/span>.callee, <span class=\"hljs-number\">0<\/span> );\n                <span class=\"hljs-keyword\">return<\/span>;\n            }\n            doReady();\n        })();\n        window.attachEvent(<span class=\"hljs-string\">'onload'<\/span>,doReady);\n    }\n    <span class=\"hljs-comment\">\/*Webkit*\/<\/span>\n    <span class=\"hljs-keyword\">else<\/span> <span class=\"hljs-keyword\">if<\/span> (Browser.webkit &amp;&amp; Browser.version &lt; <span class=\"hljs-number\">525<\/span>){\n        (<span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n            <span class=\"hljs-keyword\">if<\/span>( isReady ) <span class=\"hljs-keyword\">return<\/span>;\n            <span class=\"hljs-keyword\">if<\/span> (<span class=\"hljs-regexp\">\/loaded|complete\/<\/span>.test(document.readyState))\n                doReady();\n            <span class=\"hljs-keyword\">else<\/span>\n                setTimeout( <span class=\"hljs-built_in\">arguments<\/span>.callee, <span class=\"hljs-number\">0<\/span> );\n        })();\n        window.addEventListener(<span class=\"hljs-string\">'load'<\/span>,doReady,<span class=\"hljs-literal\">false<\/span>);\n    }\n    <span class=\"hljs-comment\">\/*FF Opera \u9ad8\u7248webkit \u5176\u4ed6*\/<\/span>\n    <span class=\"hljs-keyword\">else<\/span>{\n        <span class=\"hljs-keyword\">if<\/span>( !Browser.ff || Browser.version != <span class=\"hljs-number\">2<\/span> || <span class=\"hljs-keyword\">this<\/span>.conf.enableMozDOMReady)\n            document.addEventListener( <span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function<\/span><span class=\"hljs-params\">()<\/span>{<\/span>\n                document.removeEventListener( <span class=\"hljs-string\">\"DOMContentLoaded\"<\/span>, <span class=\"hljs-built_in\">arguments<\/span>.callee, <span class=\"hljs-literal\">false<\/span> );\n                doReady();\n            }, <span class=\"hljs-literal\">false<\/span> );\n        window.addEventListener(<span class=\"hljs-string\">'load'<\/span>,doReady,<span class=\"hljs-literal\">false<\/span>);\n    }\n}<\/code><\/pre>\n\n<p>\u8f6c\u81ea\uff1a<a href=\"http:\/\/www.cnblogs.com\/JulyZhang\/archive\/2011\/02\/12\/1952484.html\">http:\/\/www.cnblogs.com\/JulyZhang\/archive\/2011\/02\/12\/1952484.html<\/a><\/p>\n\n<p>PS\uff1a\u867d\u7136\u660e\u767d\u662f\u5e72\u561b\u7684\uff0c\u4f46\u662f\u5b8c\u5168\u770b\u4e0d\u61c2\uff01~<\/p>","markdowncontent":"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u573a\u666f\uff0c\u5f53\u9875\u9762\u52a0\u8f7d\u5b8c\u6210\u540e\u53bb\u505a\u4e00\u4e9b\u4e8b\u60c5\uff1a\u7ed1\u5b9a\u4e8b\u4ef6\u3001DOM\u64cd\u4f5c\u67d0\u4e9b\u7ed3\u70b9\u7b49\u3002\u539f\u6765\u6bd4\u8f83\u5e38\u7528\u7684\u662fwindow\u7684onload \u4e8b\u4ef6\uff0c\u800c\u8be5\u4e8b\u4ef6\u7684\u5b9e\u9645\u6548\u679c\u662f\uff1a\u5f53\u9875\u9762\u89e3\u6790\/DOM\u6811\u5efa\u7acb\u5b8c\u6210\uff0c\u5e76\u5b8c\u6210\u4e86\u8bf8\u5982\u56fe\u7247\u3001\u811a\u672c\u3001\u6837\u5f0f\u8868\u751a\u81f3\u662fiframe\u4e2d\u6240\u6709\u8d44\u6e90\u7684\u4e0b\u8f7d\u540e\u624d\u89e6\u53d1\u7684\u3002\u8fd9\u5bf9\u4e8e\u5f88\u591a \u5b9e\u9645\u7684\u5e94\u7528\u800c\u8a00\u6709\u70b9\u592a\u201c\u8fdf\u201d\u4e86\uff0c\u6bd4\u8f83\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cff\u4e2d\u4fbf\u589e\u52a0\u4e86\u4e00\u4e2aDOMContentLoaded\u65b9\u6cd5\uff0c\u4e0eonload\u76f8\u6bd4\uff0c\u8be5 \u65b9\u6cd5\u89e6\u53d1\u7684\u65f6\u95f4\u66f4\u65e9\uff0c\u5b83\u662f\u5728\u9875\u9762\u7684DOM\u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210\u540e\u5373\u89e6\u53d1\uff0c\u800c\u65e0\u9700\u7b49\u5f85\u5176\u4ed6\u8d44\u6e90\u7684\u52a0\u8f7d\u3002Webkit\u5f15\u64ce\u4ece\u7248\u672c525\uff08Webkit nightly 1\/2008:525+\uff09\u5f00\u59cb\u4e5f\u5f15\u5165\u4e86\u8be5\u4e8b\u4ef6\uff0cOpera\u4e2d\u4e5f\u5305\u542b\u8be5\u65b9\u6cd5\u3002\u5230\u76ee\u524d\u4e3a\u6b62\u4e3b\u6d41\u7684IE\u4ecd\u7136\u6ca1\u6709\u8981\u6dfb\u52a0\u7684\u610f\u601d\u3002\u867d\u7136IE\u4e0b\u6ca1\u6709\uff0c\u4f46\u603b\u662f\u6709\u89e3\u51b3\u529e\u6cd5 \u7684\uff0c\u4e0b\u6587\u5bf9\u6bd4\u4e86\u4e00\u4e0b\u51e0\u5927\u4e3b\u6d41\u6846\u67b6\u5bf9\u4e8e\u8be5\u4e8b\u4ef6\u7684\u517c\u5bb9\u6027\u7248\u672c\u5b9e\u73b0\u65b9\u6848\uff0c\u6d89\u53ca\u7684\u6846\u67b6\u5305\u62ec\uff1a\n\n 1. Prototype\n 2. jQeury\n 3. moontools\n 4. dojo\n 5. yui\n 6. ext\n\n##\u4e00\u3001Prototype##\n\n```\n(function() {\n    \/* Support for the DOMContentLoaded event is based on work by Dan Webb,\nMatthias Miller, Dean Edwards and John Resig. *\/\n    var timer;\n    function fireContentLoadedEvent() {\n        if (document.loaded) return;\n        if (timer) window.clearInterval(timer);\n        document.fire(\"dom:loaded\");\n        document.loaded = true;\n    }\n    if (document.addEventListener) {\n        if (Prototype.Browser.WebKit) {\n            timer = window.setInterval(function() {\n                if (\/loaded|complete\/.test(document.readyState))\n                    fireContentLoadedEvent();\n            }, 0);\n            Event.observe(window, \"load\", fireContentLoadedEvent);\n        } else {\n            document.addEventListener(\"DOMContentLoaded\",\n                fireContentLoadedEvent, false);\n        }\n    } else {\n        document.write(\"<\"+\"script id=__onDOMContentLoaded defer src=\/\/:><\\\/script>\");\n        $(\"__onDOMContentLoaded\").onreadystatechange = function() {\n            if (this.readyState == \"complete\") {\n                this.onreadystatechange = null;\n                fireContentLoadedEvent();\n            }\n        };\n    }\n})();\n```\n\n\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a\n\n\n\n 1. \u5982\u679c\u662fwebkit\u5219\u8f6e\u8be2document\u7684readyState\u5c5e\u6027\uff0c\u5982\u679c\u8be5\u5c5e\u6027\u7684\u503c\u4e3aloaded\u6216complete\u5219\u89e6\u53d1DOMContentLoaded\u4e8b\u4ef6\uff0c\u4e3a\u4fdd\u9669\u8d77\u89c1\uff0c\u5c06\u8be5\u4e8b\u4ef6\u6ce8\u518c\u5230window.onload\u4e0a\u3002\n 2. \u5982\u679c\u662fFF\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6\u3002\n 3.  \u5982\u679c\u662fIE\u5219\u4f7f\u7528document.write\u5f80\u9875\u9762\u4e2d\u52a0\u5165\u4e00\u4e2ascript\u5143\u7d20\uff0c\u5e76\u8bbe\u7f6edefer\u5c5e\u6027\uff0c\u6700\u540e\u662f\u628a\u8be5\u811a\u672c\u7684\u52a0\u8f7d\u5b8c\u6210\u89c6\u4f5cDOMContentLoaded\u4e8b\u4ef6\u6765\u89e6\u53d1\u3002\n\n\u8be5\u5b9e\u73b0\u65b9\u5f0f\u7684\u95ee\u9898\u4e3b\u8981\u6709\u4e24\u70b9\uff1a\u7b2c\u4e00\u3001\u901a\u8fc7document.write\u5199script\u5e76\u8bbe\u7f6edefer\u7684\u65b9\u6cd5\u5728\u9875\u9762\u5305\u542biframe\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u7b49\u5230 iframe\u5185\u7684\u5185\u5bb9\u52a0\u8f7d\u5b8c\u540e\u624d\u89e6\u53d1\uff0c\u8fd9\u4e0eonload\u6ca1\u6709\u592a\u5927\u7684\u533a\u522b\uff1b\u7b2c\u4e8c\u3001Webkit\u5728525\u4ee5\u4e0a\u7684\u7248\u672c\u5f15\u5165\u4e86DOMContentLoaded\u65b9 \u6cd5\uff0c\u56e0\u6b64\u5728\u8fd9\u4e9b\u7248\u672c\u4e2d\u65e0\u9700\u518d\u901a\u8fc7\u8f6e\u8be2\u6765\u5b9e\u73b0\uff0c\u53ef\u4ee5\u4f18\u5316\u3002\n\n##\u4e8c\u3001jQuery##\n\n```\nfunction bindReady(){\n    if ( readyBound ) return;\n    readyBound = true;\n    \/\/ Mozilla, Opera and webkit nightlies currently support this event\n     if ( document.addEventListener ) {\n        \/\/ Use the handy event callback\n         document.addEventListener( \"DOMContentLoaded\", function(){\n            document.removeEventListener( \"DOMContentLoaded\", arguments.callee, false );\n            jQuery.ready();\n        }, false );\n    \/\/ If IE event model is used\n    } else if ( document.attachEvent ) {\n        \/\/ ensure firing before onload,\n        \/\/ maybe late but safe also for iframes\n        document.attachEvent(\"onreadystatechange\", function(){\n            if ( document.readyState === \"complete\" ) {\n                document.detachEvent( \"onreadystatechange\", arguments.callee );\n                jQuery.ready();\n            }\n        });\n        \/\/ If IE and not an iframe\n        \/\/ continually check to see if the document is ready\n        if ( document.documentElement.doScroll && typeof window.frameElement === \"undefined\" ) (function(){\n            if ( jQuery.isReady ) return;\n            try {\n                \/\/ If IE is used, use the trick by Diego Perini\n                \/\/ http:\/\/javascript.nwbox.com\/IEContentLoaded\/\n                document.documentElement.doScroll(\"left\");\n            } catch( error ) {\n                setTimeout( arguments.callee, 0 );\n                return;\n            }\n            \/\/ and execute any waiting functions\n            jQuery.ready();\n        })();\n    }\n    \/\/ A fallback to window.onload, that will always work\n    jQuery.event.add( window, \"load\", jQuery.ready );\n}\n```\n\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a\n\n 1. \u5c06Webkit\u4e0eFirefox\u540c\u7b49\u5bf9\u5f85\uff0c\u90fd\u662f\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6\uff0c\u4f46\u662f\u7531\u4e8eWebkit\u662f\u5728525\u4ee5\u4e0a\u7248\u672c\u624d\u5f15\u5165\u7684\uff0c\u56e0\u6b64\u5b58\u5728\u517c\u5bb9\u6027\u7684\u9690\u60a3\u3002\n 2. \u5bf9\u4e8eIE\uff0c\u9996\u5148\u6ce8\u518cdocument\u7684onreadystatechange\u4e8b\u4ef6\uff0c\u7ecf\u6d4b\u8bd5\uff0c\u8be5\u65b9\u5f0f\u4e0ewindow.onload\u76f8\u5f53\uff0c\u4f9d\u7136\u4f1a\u7b49\u5230\u6240\u6709\u8d44\u6e90\u4e0b\u8f7d\u5b8c\u6bd5\u540e\u624d\u89e6\u53d1\u3002\n 3. \u4e4b\u540e\uff0c\u5224\u65ad\u5982\u679c\u662fIE\u5e76\u4e14\u9875\u9762\u4e0d\u5728iframe\u5f53\u4e2d\uff0c\u5219\u901a\u8fc7setTiemout\u6765\u4e0d\u65ad\u7684\u8c03\u7528documentElement\u7684doScroll\u65b9\u6cd5\uff0c\u76f4\u5230\u8c03\u7528\u6210\u529f\u5219\u51fa\u89e6\u53d1DOMContentLoaded\n \njQuery\u5bf9\u4e8eIE\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f7f\u7528\u4e86\u4e00\u79cd\u65b0\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u6e90\u81eahttp:\/\/javascript.nwbox.com\/IEContentLoaded\/\u3002 \u5b83\u7684\u539f\u7406\u662f\uff0c\u5728IE\u4e0b\uff0cDOM\u7684\u67d0\u4e9b\u65b9\u6cd5\u53ea\u6709\u5728DOM\u89e3\u6790\u5b8c\u6210\u540e\u624d\u53ef\u4ee5\u8c03\u7528\uff0cdoScroll\u5c31\u662f\u8fd9\u6837\u4e00\u4e2a\u65b9\u6cd5\uff0c\u53cd\u8fc7\u6765\u5f53\u80fd\u8c03\u7528doScroll\u7684\u65f6\u5019\u5373 \u662fDOM\u89e3\u6790\u5b8c\u6210\u4e4b\u65f6\uff0c\u4e0eprototype\u4e2d\u7684document.write\u76f8\u6bd4\uff0c\u8be5\u65b9\u6848\u53ef\u4ee5\u89e3\u51b3\u9875\u9762\u6709iframe\u65f6\u5931\u6548\u7684\u95ee\u9898\u3002\u6b64\u5916\uff0cjQuery \u4f3c\u4e4e\u62c5\u5fc3\u5f53\u9875\u9762\u5904\u4e8eiframe\u4e2d\u65f6\uff0c\u8be5\u65b9\u6cd5\u4f1a\u5931\u6548\uff0c\u56e0\u6b64\u5b9e\u73b0\u4ee3\u7801\u4e2d\u505a\u4e86\u5224\u65ad\uff0c\u5982\u679c\u662f\u5728iframe\u4e2d\u5219\u901a\u8fc7document\u7684 onreadystatechange\u6765\u5b9e\u73b0\uff0c\u5426\u5219\u901a\u8fc7doScroll\u6765\u5b9e\u73b0\u3002\u4e0d\u8fc7\u7ecf\u6d4b\u8bd5\uff0c\u5373\u4f7f\u662f\u5728iframe\u4e2d\uff0cdoScroll\u4f9d\u7136\u6709\u6548\u3002\n\n##\u4e09\u3001Moontools##\n\n```\n(function(){\n    var domready = function(){\n        if (Browser.loaded) return;\n        Browser.loaded = true;\n        window.fireEvent('domready');\n        document.fireEvent('domready');\n    };\n    if (Browser.Engine.trident){\n        var temp = document.createElement('div');\n        (function(){\n            ($try(function(){\n                temp.doScroll('left');\n                return $(temp).inject(document.body).set('html', 'temp').dispose();\n            })) ? domready() : arguments.callee.delay(50);\n        })();\n    } else if (Browser.Engine.webkit && Browser.Engine.version < 525){\n        (function(){\n            (['loaded', 'complete'].contains(document.readyState)) ? domready() : arguments.callee.delay(50);\n        })();\n    } else {\n        window.addEvent('load', domready);\n        document.addEvent('DOMContentLoaded', domready);\n    }\n})();\n```\n\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a\n\n 1. \u5982\u679c\u662fIE\u5219\u4f7f\u7528doScroll\u65b9\u6cd5\u6765\u5b9e\u73b0\u3002\n 2. \u5982\u679c\u662f\u5c0f\u4e8e525\u7248\u672c\u7684Webkit\u5219\u901a\u8fc7\u8f6e\u8be2document.readyState\u6765\u5b9e\u73b0\u3002\n 3. \u5176\u4ed6\u7684(FF\/Webkit\u9ad8\u7248\/Opera)\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded\u4e8b\u4ef6\n\nMoontools\u7684\u5b9e\u73b0\u65b9\u6848prototype\u548cjQeury\u4e2d\u7684\u7efc\u5408\u4f53\uff0c\u5bf9webkit\u505a\u4e86\u7248\u672c\u5224\u65ad\u5219\u4f7f\u5f97\u8be5\u65b9\u6848\u66f4\u52a0\u7684\u5065\u58ee\u3002\u5728doScroll\u7684\u5b9e\u73b0\u65b9\u9762\uff0c\u4e0ejQuery\u76f8\u6bd4\uff0c\u8fd9\u91cc\u662f\u65b0\u5efa\u4e86\u4e00\u4e2adiv\u5143\u7d20\uff0c\u5e76\u4e14\u5728\u4f7f\u7528\u5b8c\u6bd5\u540e\u8fdb\u884c\u9500\u6bc1\uff0c\u800cjQuery\u5219\u76f4\u63a5\u4f7f\u7528\u4e86documentElement\u7684 doScroll\u6765\u68c0\u6d4b\uff0c\u66f4\u7b80\u5355\u9ad8\u6548\u4e00\u4e9b\u3002\n\n##\u56db\u3001Dojo##\n\n```\n\/\/ START DOMContentLoaded\n\/\/ Mozilla and Opera 9 expose the event we could use\nif(document.addEventListener){\n    \/\/ NOTE:\n    \/\/  due to a threading issue in Firefox 2.0, we can't enable\n    \/\/  DOMContentLoaded on that platform. For more information, see:\n    \/\/  http:\/\/trac.dojotoolkit.org\/ticket\/1704\n    if(dojo.isOpera || dojo.isFF >= 3 || (dojo.isMoz && dojo.config.enableMozDomContentLoaded === true)){\n        document.addEventListener(\"DOMContentLoaded\", dojo._loadInit, null);\n    }\n    \/\/ mainly for Opera 8.5, won't be fired if DOMContentLoaded fired already.\n    \/\/  also used for Mozilla because of trac #1640\n    window.addEventListener(\"load\", dojo._loadInit, null);\n}\nif(dojo.isAIR){\n    window.addEventListener(\"load\", dojo._loadInit, null);\n}else if(\/(WebKit|khtml)\/i.test(navigator.userAgent)){ \/\/ sniff\n    dojo._khtmlTimer = setInterval(function(){\n        if(\/loaded|complete\/.test(document.readyState)){\n            dojo._loadInit(); \/\/ call the onload handler\n        }\n    }, 10);\n}\n\/\/ END DOMContentLoaded\n\n(function(){\n    var _w = window;\n    var _handleNodeEvent = function(\/*String*\/evtName, \/*Function*\/fp){\n        \/\/ summary:\n        \/\/  non-destructively adds the specified function to the node's\n        \/\/  evtName handler.\n        \/\/ evtName: should be in the form \"onclick\" for \"onclick\" handlers.\n        \/\/ Make sure you pass in the \"on\" part.\n        var oldHandler = _w[evtName] || function(){};\n        _w[evtName] = function(){\n            fp.apply(_w, arguments);\n            oldHandler.apply(_w, arguments);\n        };\n    };\n    if(dojo.isIE){\n        \/\/  for Internet Explorer. readyState will not be achieved on init\n        \/\/  call, but dojo doesn't need it however, we'll include it\n        \/\/  because we don't know if there are other functions added that\n        \/\/  might.  Note that this has changed because the build process\n        \/\/  strips all comments -- including conditional ones.\n        if(!dojo.config.afterOnLoad){\n            document.write('<scr'+'ipt defer=\"\" src=\"\/\/:\" +=\"\" onreadystatechange=\"if(this.readyState==\\'complete\\'){' + dojo._scopeName + '._loadInit();}\">'\n                + '<\/scr'+'ipt>'\n                );\n        }\n        try{\n            document.namespaces.add(\"v\",\"urn:schemas-microsoft-com:vml\");\n            document.createStyleSheet().addRule(\"v\\\\:*\", \"behavior:url(#default#VML)\");\n        }catch(e){}\n    }\n    \/\/ FIXME: dojo.unloaded requires dojo scope, so using anon function wrapper.\n    _handleNodeEvent(\"onbeforeunload\", function() {\n        dojo.unloaded();\n    });\n    _handleNodeEvent(\"onunload\", function() {\n        dojo.windowUnloaded();\n    });\n})();\n```\n\u5b9e\u73b0\u601d\u8def\u5982\u4e0b\uff1a\n\n 1. \u5982\u679c\u662fOpera\u6216FF3\u4ee5\u4e0a\u7248\u672c\u5219\u76f4\u63a5\u6ce8\u518cDOMContentLoaded<\u4e8b\u4ef6\uff0c\u4e3a\u4fdd\u9669\u8d77\u89c1\uff0c\u540c\u65f6\u4e5f\u6ce8\u518c\u4e86window.onload\u4e8b\u4ef6\u3002\n 2.  \u5bf9\u4e8ewebkit\u5219\u901a\u8fc7\u8f6e\u8be2document.readyState\u6765\u5b9e\u73b0\u3002\n 3.  \u5982\u679c\u662fAir\u5219\u53ea\u6ce8\u518cwidnow.onload\u4e8b\u4ef6\u3002\n 4. \u5982\u679c\u662fIE\u5219\u901a\u8fc7\u5f80\u9875\u9762\u5199\u5e26defer\u5c5e\u6027\u7684script\u5e76\u6ce8\u518c\u5176onreadystatechange\u4e8b\u4ef6\u6765\u5b9e\u73b0\u3002\n\nDojo\u5728IE\u4e0b\u7684\u5b9e\u73b0\u65b9\u6848\u540c\u6837\u65e0\u6cd5\u89e3\u51b3iframe\u7684\u95ee\u9898\uff0c\u800c\u7531\u4e8e\u5728FF2 \u4e0b\u4f1a\u6709\u4e00\u4e2a\u975e\u5e38\u5947\u602a\u7684Bug\uff0c\u56e0\u6b64\u9ed8\u8ba4\u53ea\u5728FF3\u4ee5\u4e0a\u7248\u672c\u4e0a\u4f7f\u7528DOMContentLoaded\u4e8b\u4ef6\uff0c\u540c\u65f6\u53c8\u7ed9\u4e86\u4e00\u4e2a\u914d\u7f6e -dojo.config.enableMozDomContentLoaded\uff0c\u5982\u679c\u5728FF\u4e0b\u5c06\u8be5\u914d\u7f6e\u8bbe\u7f6e\u4e3atrue\u5219\u4f9d\u7136\u4f1a\u4f7f\u7528 DOMContentLoaded\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e00\u70b9\u5145\u5206\u8003\u8651\u5230\u4e86\u7075\u6d3b\u6027\u3002\u5bf9\u4e8ewebkit\u7684\u5b9e\u73b0\uff0c\u4e0eprototype\u4e00\u6837\u6709\u4f18\u5316\u7684\u7a7a\u95f4\u3002\n\n##\u4e94\u3001YUI\n\n```\n(function() {\n    \/*! DOMReady: based on work by: Dean Edwards\/John Resig\/Matthias Miller *\/\n    \/\/ Internet Explorer: use the readyState of a defered script.\n    \/\/ This isolates what appears to be a safe moment to manipulate\n    \/\/ the DOM prior to when the document's readyState suggests\n    \/\/ it is safe to do so.\n    if (EU.isIE) {\n        \/\/ Process onAvailable\/onContentReady items when the\n        \/\/ DOM is ready.\n        YAHOO.util.Event.onDOMReady(\n            YAHOO.util.Event._tryPreloadAttach,\n            YAHOO.util.Event, true);\n        var n = document.createElement('p');\n        EU._dri = setInterval(function() {\n            try {\n                \/\/ throws an error if doc is not ready\n                n.doScroll('left');\n                clearInterval(EU._dri);\n                EU._dri = null;\n                EU._ready();\n                n = null;\n            } catch (ex) {\n            }\n        }, EU.POLL_INTERVAL);\n    \/\/ The document's readyState in Safari currently will\n    \/\/ change to loaded\/complete before images are loaded.\n    } else if (EU.webkit && EU.webkit < 525) {\n        EU._dri = setInterval(function() {\n            var rs=document.readyState;\n            if (\"loaded\" == rs || \"complete\" == rs) {\n                clearInterval(EU._dri);\n                EU._dri = null;\n                EU._ready();\n            }\n        }, EU.POLL_INTERVAL);\n    \/\/ FireFox and Opera: These browsers provide a event for this\n    \/\/ moment.  The latest WebKit releases now support this event.\n    } else {\n        EU._simpleAdd(document, \"DOMContentLoaded\", EU._ready);\n    }\n    \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\n    EU._simpleAdd(window, \"load\", EU._load);\n    EU._simpleAdd(window, \"unload\", EU._unload);\n    EU._tryPreloadAttach();\n})();\n```\n\u5b9e\u73b0\u601d\u8def\u4e0eMoontools\u4e00\u6837\n\n##\u516d\u3001EXT\n\n```\nfunction initDocReady(){\n    var COMPLETE = \"complete\";\n    docReadyEvent = new Ext.util.Event();\n    if (Ext.isGecko || Ext.isOpera) {\n        DOC.addEventListener(DOMCONTENTLOADED, fireDocReady, false);\n    } else if (Ext.isIE){\n        DOC.write(\"<script id=\" + IEDEFERED + \" defer=defer src='\/%27+%27\/:'><\/script>\");\n        DOC.getElementById(IEDEFERED).onreadystatechange = function(){\n            if(this.readyState == COMPLETE){\n                fireDocReady();\n            }\n        };\n    } else if (Ext.isWebKit){\n        docReadyProcId = setInterval(function(){\n            if(DOC.readyState == COMPLETE) {\n                fireDocReady();\n            }\n        }, 10);\n    }\n    \/\/ no matter what, make sure it fires on load\n    E.on(WINDOW, \"load\", fireDocReady);\n}\n```\n\u5b9e\u73b0\u601d\u8def\u4e0eDojo\u7684\u4e00\u81f4\uff0c\u4e0d\u518d\u8d58\u8bc9\u3002\n##\u603b\u7ed3\n\u603b\u7ed3\u5404\u5927\u4e3b\u6d41\u6846\u67b6\u7684\u505a\u6cd5\uff0c\u5199\u4e86\u4ee5\u4e0b\u8fd9\u4e2a\u7248\u672c\u3002\u4e3b\u8981\u662f\u5c3d\u91cf\u7684\u505a\u5230\u4f18\u5316\u5e76\u8003\u8651\u5230FF2\u4e0b\u7684Bug\uff0c\u63d0\u4f9b\u4e00\u4e2a\u662f\u5426\u4f7f\u7528DOMContentLoaded\u7684\u5f00\u5173\u914d\u7f6e\u3002\n\n```\n\/*\n* \u6ce8\u518c\u6d4f\u89c8\u5668\u7684DOMContentLoaded\u4e8b\u4ef6\n* @param { Function } onready [\u5fc5\u586b]\u5728DOMContentLoaded\u4e8b\u4ef6\u89e6\u53d1\u65f6\u9700\u8981\u6267\u884c\u7684\u51fd\u6570\n* @param { Object } config [\u53ef\u9009]\u914d\u7f6e\u9879\n*\/\nfunction onDOMContentLoaded(onready,config){\n    \/\/\u6d4f\u89c8\u5668\u68c0\u6d4b\u76f8\u5173\u5bf9\u8c61\uff0c\u5728\u6b64\u4e3a\u8282\u7701\u4ee3\u7801\u672a\u5b9e\u73b0\uff0c\u5b9e\u9645\u4f7f\u7528\u65f6\u9700\u8981\u5b9e\u73b0\u3002\n    \/\/var Browser = {};\n    \/\/\u8bbe\u7f6e\u662f\u5426\u5728FF\u4e0b\u4f7f\u7528DOMContentLoaded\uff08\u5728FF2\u4e0b\u7684\u7279\u5b9a\u573a\u666f\u6709Bug\uff09\n    this.conf = {\n        enableMozDOMReady:true\n    };\n    if( config )\n        for( var p in config)\n            this.conf[p] = config[p];\n    var isReady = false;\n    function doReady(){\n        if( isReady ) return;\n        \/\/\u786e\u4fddonready\u53ea\u6267\u884c\u4e00\u6b21\n        isReady = true;\n        onready();\n    }\n    \/*IE*\/\n    if( Browser.ie ){\n        (function(){\n            if ( isReady ) return;\n            try {\n                document.documentElement.doScroll(\"left\");\n            } catch( error ) {\n                setTimeout( arguments.callee, 0 );\n                return;\n            }\n            doReady();\n        })();\n        window.attachEvent('onload',doReady);\n    }\n    \/*Webkit*\/\n    else if (Browser.webkit && Browser.version < 525){\n        (function(){\n            if( isReady ) return;\n            if (\/loaded|complete\/.test(document.readyState))\n                doReady();\n            else\n                setTimeout( arguments.callee, 0 );\n        })();\n        window.addEventListener('load',doReady,false);\n    }\n    \/*FF Opera \u9ad8\u7248webkit \u5176\u4ed6*\/\n    else{\n        if( !Browser.ff || Browser.version != 2 || this.conf.enableMozDOMReady)\n            document.addEventListener( \"DOMContentLoaded\", function(){\n                document.removeEventListener( \"DOMContentLoaded\", arguments.callee, false );\n                doReady();\n            }, false );\n        window.addEventListener('load',doReady,false);\n    }\n}\n```\n\n\u8f6c\u81ea\uff1ahttp:\/\/www.cnblogs.com\/JulyZhang\/archive\/2011\/02\/12\/1952484.html\n\nPS\uff1a\u867d\u7136\u660e\u767d\u662f\u5e72\u561b\u7684\uff0c\u4f46\u662f\u5b8c\u5168\u770b\u4e0d\u61c2\uff01~","private":0,"tags":"DOMReady\u4e8b\u4ef6,javascript","categories":"JavaScript","channel":"16","type":"repost","status":1},"error":"","status":true}