{"data":{"id":"76609114","title":"Shell \u547d\u4ee4\u884c\u7edf\u8ba1 apache \u7f51\u7ad9\u65e5\u5fd7\u8bbf\u95eeIP\u4ee5\u53caIP\u5f52\u5c5e\u5730","articleedittype":1,"description":"Shell \u547d\u4ee4\u884c\u7edf\u8ba1 apache \u7f51\u7ad9\u65e5\u5fd7\u8bbf\u95eeIP\u4ee5\u53caIP\u5f52\u5c5e\u5730\u6211\u7684\u4e00\u4e2a\u7ad9\u70b9\u7528 apache \u670d\u52a1\u8dd1\u7740\uff0c\u79ef\u6512\u4e86\u5f88\u591a\u7684\u65e5\u5fd7\u3002\u6211\u60f3\u7528 shell \u770b\u770b\u6709\u54ea\u4e9b\u4eba\u8bbf\u95ee\u8fc7\u6211\u7684\u7ad9\u70b9\uff0c\u5e76\u4e14\u4ed6\u6765\u81ea\u54ea\u91cc\u3002\u56e0\u4e3a\u65e5\u5fd7\u592a\u957f\u4e86\uff0c\u6240\u4ee5\u6211\u6ca1\u8dd1\u5b8c\u5c31\u653e\u5f03\u4e86\uff0c\u56e0\u4e3a\u8dd1\u8d77\u6765\u592a\u6162\u4e86\u3002\u3002\u3002\u5206\u6790 apache \u65e5\u5fd7140.205.16.220 - - [26\/Jun\/2017:03:49:51 +0800] \"GET \/content_ar","content":"<h1 id=\"shell-\u547d\u4ee4\u884c\u7edf\u8ba1-apache-\u7f51\u7ad9\u65e5\u5fd7\u8bbf\u95eeip\u4ee5\u53caip\u5f52\u5c5e\u5730\">Shell \u547d\u4ee4\u884c\u7edf\u8ba1 apache \u7f51\u7ad9\u65e5\u5fd7\u8bbf\u95eeIP\u4ee5\u53caIP\u5f52\u5c5e\u5730<\/h1>\n\n<p>\u6211\u7684\u4e00\u4e2a\u7ad9\u70b9\u7528 apache \u670d\u52a1\u8dd1\u7740\uff0c\u79ef\u6512\u4e86\u5f88\u591a\u7684\u65e5\u5fd7\u3002\u6211\u60f3\u7528 shell \u770b\u770b\u6709\u54ea\u4e9b\u4eba\u8bbf\u95ee\u8fc7\u6211\u7684\u7ad9\u70b9\uff0c\u5e76\u4e14\u4ed6\u6765\u81ea\u54ea\u91cc\u3002<\/p>\n\n<p>\u56e0\u4e3a\u65e5\u5fd7\u592a\u957f\u4e86\uff0c\u6240\u4ee5\u6211\u6ca1\u8dd1\u5b8c\u5c31\u653e\u5f03\u4e86\uff0c\u56e0\u4e3a\u8dd1\u8d77\u6765\u592a\u6162\u4e86\u3002\u3002\u3002<\/p>\n\n\n\n<h2 id=\"\u5206\u6790-apache-\u65e5\u5fd7\">\u5206\u6790 apache \u65e5\u5fd7<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs bash\"><span class=\"hljs-number\">140.205<\/span>.<span class=\"hljs-number\">16.220<\/span> - - [<span class=\"hljs-number\">26<\/span>\/Jun\/<span class=\"hljs-number\">2017<\/span>:<span class=\"hljs-number\">03<\/span>:<span class=\"hljs-number\">49<\/span>:<span class=\"hljs-number\">51<\/span> +<span class=\"hljs-number\">0800<\/span>] <span class=\"hljs-string\">\"GET \/content_article_3.html HTTP\/1.1\"<\/span> <span class=\"hljs-number\">200<\/span> <span class=\"hljs-number\">3<\/span><\/code><\/pre>\n\n<p>\u65e5\u5fd7\u5185\u5bb9\u5982\u4e0a\uff0c\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u4ee5\u7a7a\u683c\u5206\u5272\uff0c\u53d6\u7b2c\u4e00\u4e2a\u5c31\u5f97\u5230\u4e86IP\u4e86\u3002<\/p>\n\n\n\n<h2 id=\"\u7f16\u5199\u811a\u672c\">\u7f16\u5199\u811a\u672c<\/h2>\n\n\n\n<pre class=\"prettyprint\"><code class=\" hljs bash\">i=<span class=\"hljs-number\">1<\/span>\n<span class=\"hljs-comment\"># \u8981\u5206\u6790\u7684\u65e5\u5fd7\u6587\u4ef6<\/span>\nlog=apache.log\nl=$(wc <span class=\"hljs-operator\">-l<\/span> <span class=\"hljs-variable\">$log<\/span> | sed <span class=\"hljs-string\">'s\/^[ \\t]*\/\/g'<\/span> | cut <span class=\"hljs-operator\">-d<\/span> <span class=\"hljs-string\">' '<\/span> <span class=\"hljs-operator\">-f<\/span>1)\n<span class=\"hljs-built_in\">echo<\/span> <span class=\"hljs-variable\">$l<\/span>\n<span class=\"hljs-keyword\">while<\/span> <span class=\"hljs-built_in\">read<\/span> line; <span class=\"hljs-keyword\">do<\/span>\n  <span class=\"hljs-built_in\">echo<\/span> -en <span class=\"hljs-string\">\"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\"<\/span>`<span class=\"hljs-built_in\">echo<\/span> <span class=\"hljs-variable\">$i<\/span>*<span class=\"hljs-number\">100<\/span>\/<span class=\"hljs-variable\">$l<\/span> | bc `<span class=\"hljs-string\">'%\/'<\/span><span class=\"hljs-variable\">$i<\/span><span class=\"hljs-string\">'\/'<\/span><span class=\"hljs-variable\">$l<\/span>\n  ((i++))\n  ip=`<span class=\"hljs-built_in\">echo<\/span> <span class=\"hljs-variable\">$line<\/span> | cut <span class=\"hljs-operator\">-d<\/span> <span class=\"hljs-string\">' '<\/span> <span class=\"hljs-operator\">-f<\/span>1`\n  grep <span class=\"hljs-string\">\"\\&lt;<span class=\"hljs-variable\">$ip<\/span>\\&gt;\"<\/span> ip.txt &gt;\/dev\/null\n  <span class=\"hljs-keyword\">if<\/span> [ $? <span class=\"hljs-operator\">-ne<\/span> <span class=\"hljs-number\">0<\/span> ]; <span class=\"hljs-keyword\">then<\/span>\n    curl <span class=\"hljs-operator\">-s<\/span>L http:\/\/ip.cn\/index.php?ip=<span class=\"hljs-variable\">$ip<\/span> &gt;&gt; ip.txt\n  <span class=\"hljs-keyword\">fi<\/span>\n<span class=\"hljs-keyword\">done<\/span> &lt; <span class=\"hljs-variable\">$log<\/span>\n<span class=\"hljs-built_in\">echo<\/span> <span class=\"hljs-operator\">-e<\/span> <span class=\"hljs-string\">'\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\bbOK     '<\/span><\/code><\/pre>\n\n<p>\u9996\u5148\u5462\uff0c\u5f53\u7136\u662f\u628a\u6211\u6628\u5929\u5199\u7684\u8fdb\u5ea6\u62ff\u51fa\u6765\u6574\u5408\u8fdb\u53bb\u5566\u3002<a href=\"http:\/\/blog.csdn.net\/fungleo\/article\/details\/76576487\">Shell \u5faa\u73af\u4e2d\u5b9e\u73b0\u5c55\u793a\u8fdb\u5ea6\u767e\u5206\u6bd4\u7684\u811a\u672c\u65b9\u6cd5<\/a>\uff0c\u4f46\u662f\u56e0\u4e3a\u6587\u4ef6\u662f\u5728\u662f\u592a\u957f\u4e86\u4e00\u70b9\uff0c\u767e\u5206\u6bd4\u5df2\u7ecf\u770b\u4e0d\u5230\u52a8\u6001\u7684\u8868\u73b0\uff0c\u6240\u4ee5\u5c31\u53c8\u52a0\u4e0a\u4e86\u663e\u793a\u884c\u6570\u548c\u603b\u884c\u6570\u3002<\/p>\n\n<p>\u7136\u540e\u7528 <code>cut<\/code> \u83b7\u53d6\u5230\u6bcf\u884c\u7684 <code>ip<\/code> \u5730\u5740\u3002<\/p>\n\n<p>\u7136\u540e\u7528 <code>grep<\/code> \u5728 <code>ip.txt<\/code> \u8fd9\u4e2a\u6587\u4ef6\u4e2d\u67e5\u627e\u4e00\u4e0b\u8fd9\u4e2a <code>ip<\/code> \u5b58\u5728\u4e0d\u5b58\u5728\uff0c\u4f46\u662f\u6211\u4e0d\u60f3\u628a\u7ed3\u679c\u6253\u5370\u5230\u7ec8\u7aef\uff0c\u6240\u4ee5\u7528\u8f93\u5165\u5230 <code>\/dev\/null<\/code> \u5b9e\u73b0\u7981\u6b62\u6807\u51c6\u8f93\u51fa\u3002<\/p>\n\n<p>\u7136\u540e\u7528 <code>$?<\/code> \u8f93\u51fa\u7ed3\u679c\u662f\u5426\u4e3a <code>0<\/code> \u5224\u65ad\u8fd9\u4e2a <code>ip<\/code> \u662f\u5426\u5b58\u5728\u8fc7\u3002<\/p>\n\n<p>\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u53bb <code>ip.cn<\/code> \u67e5\u8be2\u4e00\u4e0b <code>ip<\/code> \u5f52\u5c5e\u5730\uff0c\u5e76\u5c06\u7ed3\u679c\u8ffd\u52a0\u5230 <code>ip.txt<\/code> \u6587\u4ef6<\/p>\n\n<p>\u6700\u540e\u5c31\u5b8c\u6210\u4e86\u3002<\/p>\n\n<p>\u56e0\u4e3a\u8981\u4e0a\u7f51\u67e5\uff0c\u6240\u4ee5\u6548\u7387\u662f\u6bd4\u8f83\u6162\u7684\u3002\u4e0d\u8fc7\u7ed3\u679c\u4e0d\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f\u5b9e\u73b0\u7684\u8fc7\u7a0b\u3002\u901a\u8fc7\u89e3\u51b3\u95ee\u9898\uff0c\u8fd8\u662f\u5b66\u4e60\u5230\u4e24\u4e2a\u77e5\u8bc6\u70b9\u3002<\/p>\n\n<p>\u4ee5\u4e0a\u811a\u672c\u5747\u5728 mac \u4e0b\u6d4b\u8bd5\u901a\u8fc7\uff0c\u5728&nbsp;Linux&nbsp;\u4e0b\u53ef\u80fd\u4f1a\u6709\u7a0d\u8bb8\u4e0d\u540c\u3002 <br>\n\u672c\u6587\u7531 FungLeo \u539f\u521b\uff0c\u5141\u8bb8\u8f6c\u8f7d\uff0c\u4f46\u8f6c\u8f7d\u5fc5\u987b\u4fdd\u7559\u9996\u53d1\u94fe\u63a5\u3002<\/p>","markdowncontent":"# Shell \u547d\u4ee4\u884c\u7edf\u8ba1 apache \u7f51\u7ad9\u65e5\u5fd7\u8bbf\u95eeIP\u4ee5\u53caIP\u5f52\u5c5e\u5730\n\n\u6211\u7684\u4e00\u4e2a\u7ad9\u70b9\u7528 apache \u670d\u52a1\u8dd1\u7740\uff0c\u79ef\u6512\u4e86\u5f88\u591a\u7684\u65e5\u5fd7\u3002\u6211\u60f3\u7528 shell \u770b\u770b\u6709\u54ea\u4e9b\u4eba\u8bbf\u95ee\u8fc7\u6211\u7684\u7ad9\u70b9\uff0c\u5e76\u4e14\u4ed6\u6765\u81ea\u54ea\u91cc\u3002\n\n\u56e0\u4e3a\u65e5\u5fd7\u592a\u957f\u4e86\uff0c\u6240\u4ee5\u6211\u6ca1\u8dd1\u5b8c\u5c31\u653e\u5f03\u4e86\uff0c\u56e0\u4e3a\u8dd1\u8d77\u6765\u592a\u6162\u4e86\u3002\u3002\u3002\n\n## \u5206\u6790 apache \u65e5\u5fd7\n\n```\n140.205.16.220 - - [26\/Jun\/2017:03:49:51 +0800] \"GET \/content_article_3.html HTTP\/1.1\" 200 3\n```\n\n\u65e5\u5fd7\u5185\u5bb9\u5982\u4e0a\uff0c\u8fd9\u4e2a\u5f88\u7b80\u5355\uff0c\u53ea\u8981\u4ee5\u7a7a\u683c\u5206\u5272\uff0c\u53d6\u7b2c\u4e00\u4e2a\u5c31\u5f97\u5230\u4e86IP\u4e86\u3002\n\n## \u7f16\u5199\u811a\u672c\n\n```\ni=1\n# \u8981\u5206\u6790\u7684\u65e5\u5fd7\u6587\u4ef6\nlog=apache.log\nl=$(wc -l $log | sed 's\/^[ \\t]*\/\/g' | cut -d ' ' -f1)\necho $l\nwhile read line; do\n  echo -en \"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\"`echo $i*100\/$l | bc `'%\/'$i'\/'$l\n  ((i++))\n  ip=`echo $line | cut -d ' ' -f1`\n  grep \"\\<$ip\\>\" ip.txt >\/dev\/null\n  if [ $? -ne 0 ]; then\n    curl -sL http:\/\/ip.cn\/index.php?ip=$ip >> ip.txt\n  fi\ndone < $log\necho -e '\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\bbOK     '\n```\n\n\u9996\u5148\u5462\uff0c\u5f53\u7136\u662f\u628a\u6211\u6628\u5929\u5199\u7684\u8fdb\u5ea6\u62ff\u51fa\u6765\u6574\u5408\u8fdb\u53bb\u5566\u3002[Shell \u5faa\u73af\u4e2d\u5b9e\u73b0\u5c55\u793a\u8fdb\u5ea6\u767e\u5206\u6bd4\u7684\u811a\u672c\u65b9\u6cd5](http:\/\/blog.csdn.net\/fungleo\/article\/details\/76576487)\uff0c\u4f46\u662f\u56e0\u4e3a\u6587\u4ef6\u662f\u5728\u662f\u592a\u957f\u4e86\u4e00\u70b9\uff0c\u767e\u5206\u6bd4\u5df2\u7ecf\u770b\u4e0d\u5230\u52a8\u6001\u7684\u8868\u73b0\uff0c\u6240\u4ee5\u5c31\u53c8\u52a0\u4e0a\u4e86\u663e\u793a\u884c\u6570\u548c\u603b\u884c\u6570\u3002\n\n\u7136\u540e\u7528 `cut` \u83b7\u53d6\u5230\u6bcf\u884c\u7684 `ip` \u5730\u5740\u3002\n\n\u7136\u540e\u7528 `grep` \u5728 `ip.txt` \u8fd9\u4e2a\u6587\u4ef6\u4e2d\u67e5\u627e\u4e00\u4e0b\u8fd9\u4e2a `ip` \u5b58\u5728\u4e0d\u5b58\u5728\uff0c\u4f46\u662f\u6211\u4e0d\u60f3\u628a\u7ed3\u679c\u6253\u5370\u5230\u7ec8\u7aef\uff0c\u6240\u4ee5\u7528\u8f93\u5165\u5230 `\/dev\/null` \u5b9e\u73b0\u7981\u6b62\u6807\u51c6\u8f93\u51fa\u3002\n\n\u7136\u540e\u7528 `$?` \u8f93\u51fa\u7ed3\u679c\u662f\u5426\u4e3a `0` \u5224\u65ad\u8fd9\u4e2a `ip` \u662f\u5426\u5b58\u5728\u8fc7\u3002\n\n\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u53bb `ip.cn` \u67e5\u8be2\u4e00\u4e0b `ip` \u5f52\u5c5e\u5730\uff0c\u5e76\u5c06\u7ed3\u679c\u8ffd\u52a0\u5230 `ip.txt` \u6587\u4ef6\n\n\u6700\u540e\u5c31\u5b8c\u6210\u4e86\u3002\n\n\u56e0\u4e3a\u8981\u4e0a\u7f51\u67e5\uff0c\u6240\u4ee5\u6548\u7387\u662f\u6bd4\u8f83\u6162\u7684\u3002\u4e0d\u8fc7\u7ed3\u679c\u4e0d\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f\u5b9e\u73b0\u7684\u8fc7\u7a0b\u3002\u901a\u8fc7\u89e3\u51b3\u95ee\u9898\uff0c\u8fd8\u662f\u5b66\u4e60\u5230\u4e24\u4e2a\u77e5\u8bc6\u70b9\u3002\n\n\u4ee5\u4e0a\u811a\u672c\u5747\u5728 mac \u4e0b\u6d4b\u8bd5\u901a\u8fc7\uff0c\u5728\u00a0Linux\u00a0\u4e0b\u53ef\u80fd\u4f1a\u6709\u7a0d\u8bb8\u4e0d\u540c\u3002\n\u672c\u6587\u7531 FungLeo \u539f\u521b\uff0c\u5141\u8bb8\u8f6c\u8f7d\uff0c\u4f46\u8f6c\u8f7d\u5fc5\u987b\u4fdd\u7559\u9996\u53d1\u94fe\u63a5\u3002\n\n","private":0,"tags":"apache,shell,\u7edf\u8ba1ip,curl","categories":"Linux\\CentOS","channel":"14","type":"original","status":1},"error":"","status":true}